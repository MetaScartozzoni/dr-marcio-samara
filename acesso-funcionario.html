<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acesso Funcion√°rio - Portal Dr. Marcio</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="form-container">
            <h1>üîë Acesso Funcion√°rio</h1>
            <p>Digite o c√≥digo de acesso fornecido pelo administrador</p>
            
            <form id="codigoForm">
                <div class="input-group">
                    <label for="codigo">C√≥digo de Acesso:</label>
                    <input type="text" id="codigo" name="codigo" placeholder="Ex: FUNC12ABC3D4" required 
                           style="text-transform: uppercase; letter-spacing: 2px; text-align: center; font-weight: bold;">
                </div>
                
                <button type="submit" class="btn-primary">üöÄ Verificar C√≥digo</button>
            </form>
            
            <div id="loading" class="loading" style="display: none;">
                ‚è≥ Verificando c√≥digo...
            </div>
            
            <div id="message" class="message"></div>
            
            <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; font-size: 14px;">
                <strong>üìã INSTRU√á√ïES:</strong><br>
                1. Digite o c√≥digo fornecido pelo administrador<br>
                2. O c√≥digo tem formato: FUNC + 8 caracteres<br>
                3. Ap√≥s verifica√ß√£o, voc√™ poder√° definir sua senha
            </div>
            
            <p class="text-center" style="margin-top: 20px;">
                <a href="/" class="link">‚Üê Voltar ao in√≠cio</a>
            </p>
        </div>
    </div>

    <script>
        document.getElementById('codigoForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const codigo = document.getElementById('codigo').value.trim().toUpperCase();
            const loading = document.getElementById('loading');
            const message = document.getElementById('message');
            
            if (!codigo) {
                message.innerHTML = '<div style="color: red; padding: 10px; background: #f8d7da; border-radius: 5px;">‚ùå Digite o c√≥digo de acesso</div>';
                return;
            }
            
            loading.style.display = 'block';
            message.innerHTML = '';
            
            try {
                console.log('üîë Verificando c√≥digo:', codigo);
                
                const response = await fetch('/api/verificar-codigo-funcionario', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ codigo })
                });
                
                const data = await response.json();
                console.log('üì• Resposta:', data);
                
                if (data.sucesso) {
                    message.innerHTML = `
                        <div style="color: green; padding: 15px; background: #d4edda; border-radius: 5px;">
                            ‚úÖ C√≥digo v√°lido!<br>
                            <strong>Nome:</strong> ${data.nome}<br>
                            <strong>Cargo:</strong> ${data.cargo}<br>
                            <strong>Email:</strong> ${data.email}<br>
                            <br>Redirecionando para definir senha...
                        </div>
                    `;
                    
                    // Redirecionar para definir senha
                    setTimeout(() => {
                        window.location.href = data.redirect;
                    }, 2000);
                } else {
                    message.innerHTML = '<div style="color: red; padding: 10px; background: #f8d7da; border-radius: 5px;">‚ùå ' + (data.message || 'C√≥digo inv√°lido') + '</div>';
                }
            } catch (error) {
                console.error('‚ùå Erro:', error);
                message.innerHTML = '<div style="color: red; padding: 10px; background: #f8d7da; border-radius: 5px;">‚ùå Erro de conex√£o</div>';
            }
            
            loading.style.display = 'none';
        });
        
        // Auto-formata√ß√£o do c√≥digo
        document.getElementById('codigo').addEventListener('input', function(e) {
            e.target.value = e.target.value.toUpperCase();
        });
    </script>
</body>
</html>
