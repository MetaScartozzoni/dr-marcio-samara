<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gest√£o de Or√ßamentos - Dr. Marcio Scartozzoni</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="gestao-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Meta tags para SEO e acessibilidade -->
    <meta name="description" content="Sistema de gest√£o de or√ßamentos e pacientes - Dr. Marcio Scartozzoni">
    <meta name="robots" content="noindex, nofollow">
    <link rel="canonical" href="https://drmarcioscartozzoni.com/gestao">
    
    <!-- Preload recursos cr√≠ticos -->
    <link rel="preload" href="gestao-script.js" as="script">
    <link rel="preload" href="config-api-integration.js" as="script">
</head>
<body>
    <!-- Header melhorado -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <h1 class="header-title">
                    <i class="fas fa-calculator" aria-hidden="true"></i>
                    Gest√£o de Or√ßamentos
                </h1>
                
                <div class="header-actions">
                    <button onclick="abrirAgendamentoRapido()" class="btn btn-info btn-sm" title="Agendamento R√°pido">
                        <i class="fas fa-calendar-plus" aria-hidden="true"></i>
                        <span class="sr-only">Agendamento R√°pido</span>
                    </button>
                    
                    <button onclick="voltarDashboard()" class="btn btn-secondary btn-sm" title="Voltar ao Dashboard">
                        <i class="fas fa-arrow-left" aria-hidden="true"></i>
                        Dashboard
                    </button>
                    
                    <button onclick="AuthManager.logout()" class="btn btn-danger btn-sm" title="Sair do Sistema">
                        <i class="fas fa-sign-out-alt" aria-hidden="true"></i>
                        <span class="sr-only">Sair</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main content -->
    <main class="main-content">
        <div class="container">
            <!-- Navega√ß√£o por Tabs -->
            <nav class="tab-navigation" role="tablist">
                <button class="tab-button active" id="tab-orcamentos" role="tab" aria-selected="true" aria-controls="panel-orcamentos">
                    <i class="fas fa-calculator"></i>
                    Gest√£o de Or√ßamentos
                </button>
                <button class="tab-button" id="tab-pacientes" role="tab" aria-selected="false" aria-controls="panel-pacientes">
                    <i class="fas fa-users"></i>
                    Gest√£o de Pacientes
                </button>
            </nav>

            <!-- Painel de Or√ßamentos -->
            <div id="panel-orcamentos" class="tab-panel active" role="tabpanel" aria-labelledby="tab-orcamentos">
                <!-- Estat√≠sticas melhoradas -->
                <section class="stats-section" aria-labelledby="stats-title">
                    <h2 id="stats-title" class="sr-only">Estat√≠sticas dos Or√ßamentos</h2>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-calculator" aria-hidden="true"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="totalOrcamentos">0</div>
                                <div class="stat-label">Total de Or√ßamentos</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon warning">
                                <i class="fas fa-clock" aria-hidden="true"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="orcamentosPendentes">0</div>
                                <div class="stat-label">Or√ßamentos Pendentes</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon success">
                                <i class="fas fa-check-circle" aria-hidden="true"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="orcamentosAceitos">0</div>
                                <div class="stat-label">Or√ßamentos Aceitos</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon info">
                                <i class="fas fa-dollar-sign" aria-hidden="true"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="valorTotalPendente">R$ 0,00</div>
                                <div class="stat-label">Valor Total Pendente</div>
                            </div>
                        </div>
                    </div>
                </section>

            <!-- Filtros melhorados -->
            <section class="filters-section" aria-labelledby="filters-title">
                <h2 id="filters-title" class="section-title">Filtros</h2>
                
                <div class="filters-container">
                    <div class="filters-row">
                        <div class="filter-group">
                            <label for="filtroId">ID do Or√ßamento</label>
                            <input type="text" id="filtroId" class="form-control" placeholder="Ex: ORC001" autocomplete="off">
                        </div>
                        
                        <div class="filter-group">
                            <label for="filtroNome">Nome do Paciente</label>
                            <input type="text" id="filtroNome" class="form-control" placeholder="Digite o nome..." autocomplete="off">
                        </div>
                        
                        <div class="filter-group">
                            <label for="filtroStatus">Status</label>
                            <select id="filtroStatus" class="form-control">
                                <option value="">Todos os status</option>
                                <option value="Pendente">Pendente</option>
                                <option value="Enviado">Enviado</option>
                                <option value="Aceito">Aceito</option>
                                <option value="Rejeitado">Rejeitado</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="filtroDataInicio">Data In√≠cio</label>
                            <input type="date" id="filtroDataInicio" class="form-control">
                        </div>
                        
                        <div class="filter-group">
                            <label for="filtroDataFim">Data Fim</label>
                            <input type="date" id="filtroDataFim" class="form-control">
                        </div>
                        
                        <div class="filter-actions">
                            <button onclick="limparFiltros()" class="btn btn-secondary" title="Limpar todos os filtros">
                                <i class="fas fa-eraser" aria-hidden="true"></i>
                                Limpar
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- A√ß√µes principais -->
            <section class="actions-section" aria-labelledby="actions-title">
                <h2 id="actions-title" class="sr-only">A√ß√µes Principais</h2>
                
                <div class="actions-bar">
                    <button onclick="adicionarOrcamento()" class="btn btn-primary">
                        <i class="fas fa-plus" aria-hidden="true"></i>
                        Novo Or√ßamento
                    </button>
                    
                    <button onclick="exportarDados()" class="btn btn-info">
                        <i class="fas fa-download" aria-hidden="true"></i>
                        Exportar CSV
                    </button>
                    
                    <button onclick="carregarDados()" class="btn btn-secondary" title="Atualizar dados">
                        <i class="fas fa-sync-alt" aria-hidden="true"></i>
                        Atualizar
                    </button>
                </div>
            </section>

            <!-- Tabela melhorada -->
            <section class="table-section" aria-labelledby="table-title">
                <h2 id="table-title" class="section-title">Lista de Or√ßamentos</h2>
                
                <div class="table-container">
                    <div id="loading" class="table-loading" style="display: none;">
                        <div class="spinner" aria-label="Carregando dados"></div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table" role="table" aria-label="Tabela de or√ßamentos">
                            <thead>
                                <tr role="row">
                                    <th scope="col">ID</th>
                                    <th scope="col">Paciente</th>
                                    <th scope="col">Data Consulta</th>
                                    <th scope="col">Data Or√ßamento</th>
                                    <th scope="col">Procedimento</th>
                                    <th scope="col">Valor Total</th>
                                    <th scope="col">Status Or√ßamento</th>
                                    <th scope="col">Status Pagamento</th>
                                    <th scope="col">Validade</th>
                                    <th scope="col">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="corpoTabela" role="rowgroup">
                                <!-- Dados ser√£o inseridos aqui via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Modal Novo Or√ßamento - Melhorado -->
    <div id="modalNovoOrcamento" class="modal" role="dialog" aria-labelledby="modal-title" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title" class="modal-title">Novo Or√ßamento</h3>
                <button onclick="fecharModalOrcamento()" class="close" aria-label="Fechar modal">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            
            <div class="modal-body">
                <form id="formNovoOrcamento" novalidate>
                    <div class="form-group">
                        <label for="pacienteOrcamento">Paciente *</label>
                        <select id="pacienteOrcamento" name="paciente_id" class="form-control" required aria-required="true">
                            <option value="">Selecione o paciente</option>
                        </select>
                        <div class="invalid-feedback"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="dataConsulta">Data da Consulta *</label>
                        <input type="date" id="dataConsulta" name="data_consulta" class="form-control" required aria-required="true">
                        <div class="invalid-feedback"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="procedimentoPrincipal">Procedimento Principal *</label>
                        <select id="procedimentoPrincipal" name="procedimento_principal" class="form-control" required aria-required="true" onchange="calcularValorTotal()">
                            <option value="">Selecione o procedimento</option>
                            <option value="Rinoplastia" data-valor="8500">Rinoplastia</option>
                            <option value="Mamoplastia de Aumento" data-valor="12000">Mamoplastia de Aumento</option>
                            <option value="Lipoaspira√ß√£o" data-valor="7500">Lipoaspira√ß√£o</option>
                            <option value="Abdominoplastia" data-valor="10000">Abdominoplastia</option>
                            <option value="Blefaroplastia" data-valor="6000">Blefaroplastia</option>
                        </select>
                        <div class="invalid-feedback"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="procedimentosAdicionais">Procedimentos Adicionais</label>
                        <textarea id="procedimentosAdicionais" name="procedimentos_adicionais" class="form-control" rows="2" placeholder="Descreva procedimentos adicionais..."></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="valorProcedimento">Valor do Procedimento *</label>
                            <input type="number" id="valorProcedimento" name="valor_procedimento" class="form-control" step="0.01" min="0" required aria-required="true" onchange="calcularValorTotal()">
                            <div class="invalid-feedback"></div>
                        </div>
                        
                        <div class="form-group col-md-6">
                            <label for="valorAnestesia">Valor da Anestesia</label>
                            <input type="number" id="valorAnestesia" name="valor_anestesia" class="form-control" step="0.01" min="0" onchange="calcularValorTotal()">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="valorHospital">Valor do Hospital</label>
                            <input type="number" id="valorHospital" name="valor_hospital" class="form-control" step="0.01" min="0" onchange="calcularValorTotal()">
                        </div>
                        
                        <div class="form-group col-md-6">
                            <label for="valorMaterial">Valor do Material</label>
                            <input type="number" id="valorMaterial" name="valor_material" class="form-control" step="0.01" min="0" onchange="calcularValorTotal()">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="valorTotal">Valor Total *</label>
                        <input type="number" id="valorTotal" name="valor_total" class="form-control" step="0.01" min="0" required aria-required="true" readonly>
                        <div class="invalid-feedback"></div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="formaPagamento">Forma de Pagamento *</label>
                            <select id="formaPagamento" name="forma_pagamento" class="form-control" required aria-required="true">
                                <option value="">Selecione</option>
                                <option value="vista">√Ä Vista</option>
                                <option value="2x">2x sem juros</option>
                                <option value="3x">3x sem juros</option>
                                <option value="4x">4x sem juros</option>
                                <option value="6x">6x sem juros</option>
                                <option value="12x">12x com juros</option>
                            </select>
                            <div class="invalid-feedback"></div>
                        </div>
                        
                        <div class="form-group col-md-6">
                            <label for="validadeOrcamento">Validade *</label>
                            <input type="date" id="validadeOrcamento" name="validade" class="form-control" required aria-required="true">
                            <div class="invalid-feedback"></div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="observacoesOrcamento">Observa√ß√µes</label>
                        <textarea id="observacoesOrcamento" name="observacoes" class="form-control" rows="3" placeholder="Observa√ß√µes adicionais..."></textarea>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer">
                <button type="button" onclick="fecharModalOrcamento()" class="btn btn-secondary">Cancelar</button>
                <button type="submit" form="formNovoOrcamento" class="btn btn-primary">
                    <i class="fas fa-save" aria-hidden="true"></i>
                    Salvar Or√ßamento
                </button>
            </div>
        </div>
    </div>

    <!-- Modal A√ß√µes do Or√ßamento - Melhorado -->
    <div id="modalAcoesOrcamento" class="modal" role="dialog" aria-labelledby="modal-acoes-title" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-acoes-title" class="modal-title">A√ß√µes do Or√ßamento</h3>
                <button onclick="fecharModalAcoes()" class="close" aria-label="Fechar modal">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="orcamento-info">
                    <h4>Informa√ß√µes do Or√ßamento</h4>
                    <div class="info-grid">
                        <div class="info-item">
                            <strong>Or√ßamento:</strong>
                            <span id="infoOrcamento">-</span>
                        </div>
                        <div class="info-item">
                            <strong>Procedimento:</strong>
                            <span id="infoProcedimento">-</span>
                        </div>
                        <div class="info-item">
                            <strong>Valor:</strong>
                            <span id="infoValor">-</span>
                        </div>
                        <div class="info-item">
                            <strong>Status:</strong>
                            <span id="infoStatus">-</span>
                        </div>
                        <div class="info-item">
                            <strong>Validade:</strong>
                            <span id="infoValidade">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="acoes-grid">
                    <button onclick="gerarPDFOrcamento()" class="btn btn-primary btn-action">
                        <i class="fas fa-file-pdf" aria-hidden="true"></i>
                        Gerar PDF
                    </button>
                    
                    <button onclick="enviarPorEmail()" class="btn btn-info btn-action">
                        <i class="fas fa-envelope" aria-hidden="true"></i>
                        Enviar Email
                    </button>
                    
                    <button onclick="copiarOrcamento()" class="btn btn-secondary btn-action">
                        <i class="fas fa-copy" aria-hidden="true"></i>
                        Copiar Texto
                    </button>
                    
                    <button onclick="imprimirOrcamento()" class="btn btn-secondary btn-action">
                        <i class="fas fa-print" aria-hidden="true"></i>
                        Imprimir
                    </button>
                    
                    <button onclick="marcarComoAceito()" class="btn btn-success btn-action">
                        <i class="fas fa-check" aria-hidden="true"></i>
                        Marcar como Aceito
                    </button>
                    
                    <button onclick="editarOrcamento()" class="btn btn-warning btn-action">
                        <i class="fas fa-edit" aria-hidden="true"></i>
                        Editar
                    </button>
                </div>
            </div>
            
            <div class="modal-footer">
                <button onclick="fecharModalAcoes()" class="btn btn-secondary">Fechar</button>
            </div>
        </div>
    </div>
            </div> <!-- Fim do panel-orcamentos -->

            <!-- Painel de Pacientes -->
            <div id="panel-pacientes" class="tab-panel" role="tabpanel" aria-labelledby="tab-pacientes">
                <section class="stats-section">
                    <h2 class="sr-only">Estat√≠sticas dos Pacientes</h2>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-users" aria-hidden="true"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="totalPacientes">0</div>
                                <div class="stat-label">Total de Pacientes</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon info">
                                <i class="fas fa-user-plus" aria-hidden="true"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="pacientesNovos">0</div>
                                <div class="stat-label">Novos este M√™s</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon success">
                                <i class="fas fa-user-check" aria-hidden="true"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="pacientesAtivos">0</div>
                                <div class="stat-label">Pacientes Ativos</div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon warning">
                                <i class="fas fa-calendar-check" aria-hidden="true"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="consultasAgendadas">0</div>
                                <div class="stat-label">Consultas Agendadas</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Filtros para Pacientes -->
                <section class="filters-section">
                    <h2><i class="fas fa-filter"></i> Filtros de Pacientes</h2>
                    
                    <div class="filters-grid">
                        <div class="filter-group">
                            <label for="filtroNomePaciente">Nome do Paciente:</label>
                            <input type="text" id="filtroNomePaciente" class="form-control" placeholder="Digite o nome..." autocomplete="off">
                        </div>
                        
                        <div class="filter-group">
                            <label for="filtroCpfPaciente">CPF:</label>
                            <input type="text" id="filtroCpfPaciente" class="form-control" placeholder="000.000.000-00" autocomplete="off">
                        </div>
                        
                        <div class="filter-group">
                            <label for="filtroStatusPaciente">Status:</label>
                            <select id="filtroStatusPaciente" class="form-control">
                                <option value="">Todos os Status</option>
                                <option value="ativo">Ativo</option>
                                <option value="inativo">Inativo</option>
                                <option value="bloqueado">Bloqueado</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="filtroAcessoDashboard">Acesso Dashboard:</label>
                            <select id="filtroAcessoDashboard" class="form-control">
                                <option value="">Todos</option>
                                <option value="true">Com Acesso</option>
                                <option value="false">Sem Acesso</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="filters-actions">
                        <button onclick="filtrarPacientes()" class="btn btn-primary">
                            <i class="fas fa-search"></i> Filtrar
                        </button>
                        <button onclick="limparFiltrosPacientes()" class="btn btn-secondary">
                            <i class="fas fa-eraser"></i> Limpar
                        </button>
                        <button onclick="adicionarPaciente()" class="btn btn-success">
                            <i class="fas fa-user-plus"></i> Novo Paciente
                        </button>
                    </div>
                </section>

                <!-- Tabela de Pacientes -->
                <section class="table-section">
                    <h2><i class="fas fa-users"></i> Lista de Pacientes</h2>
                    
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nome</th>
                                    <th>CPF</th>
                                    <th>Email</th>
                                    <th>Telefone</th>
                                    <th>Dashboard</th>
                                    <th>Status</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="corpoTabelaPacientes">
                                <!-- Dados ser√£o inseridos aqui via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div> <!-- Fim do panel-pacientes -->
        </div>
    </main>

    <!-- Modal de A√ß√µes para Pacientes -->
    <div id="modalAcoesPaciente" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>A√ß√µes do Paciente</h3>
                <button onclick="fecharModalAcoesPaciente()" class="btn-close">√ó</button>
            </div>
            
            <div class="modal-body">
                <div class="paciente-info">
                    <h4 id="nomePacienteSelecionado">Nome do Paciente</h4>
                    <p id="detalhesPacienteSelecionado">Detalhes do paciente</p>
                </div>
                
                <div class="modal-actions">
                    <button onclick="editarPaciente()" class="btn btn-primary btn-action">
                        <i class="fas fa-edit" aria-hidden="true"></i>
                        Editar Dados
                    </button>
                    
                    <button onclick="verHistoricoPaciente()" class="btn btn-info btn-action">
                        <i class="fas fa-history" aria-hidden="true"></i>
                        Ver Hist√≥rico
                    </button>
                    
                    <button onclick="gerenciarAcesso()" class="btn btn-warning btn-action">
                        <i class="fas fa-key" aria-hidden="true"></i>
                        Gerenciar Acesso
                    </button>
                    
                    <button onclick="agendarConsulta()" class="btn btn-success btn-action">
                        <i class="fas fa-calendar-plus" aria-hidden="true"></i>
                        Agendar Consulta
                    </button>
                </div>
            </div>
            
            <div class="modal-footer">
                <button onclick="fecharModalAcoesPaciente()" class="btn btn-secondary">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="config-api-integration.js"></script>
    <script src="gestao-script.js"></script>
    
    <!-- Script de inicializa√ß√£o -->
    <script>
        // Verificar se todas as depend√™ncias est√£o carregadas
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚úÖ Sistema de gest√£o inicializado');
            
            // Verificar depend√™ncias
            if (typeof NotificationManager === 'undefined') {
                console.error('‚ùå NotificationManager n√£o carregado');
                return;
            }
            
            if (typeof AuthManager === 'undefined') {
                console.error('‚ùå AuthManager n√£o carregado');
                return;
            }
            
            // Inicializar sistema de tabs
            if (typeof initializeTabs === 'function') {
                initializeTabs();
                console.log('‚úÖ Sistema de tabs inicializado');
            }
            
            // Sistema pronto
            console.log('üöÄ Todas as depend√™ncias carregadas com sucesso');
        });
    </script>
</body>
</html>
