<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gest√£o de Or√ßamentos - Portal Dr. Marcio</title>
    <link rel="stylesheet" href="gestao-style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sistema de Gest√£o de Or√ßamentos P√≥s-Consulta -->
        <header class="dashboard-header">
            <h1><i class="fas fa-file-invoice-dollar"></i> Gest√£o de Pacientes P√≥s-Consulta - Portal Dr. Marcio</h1>
            <div class="header-actions">
                <button onclick="voltarDashboard()" class="btn-back"><i class="fas fa-arrow-left"></i> Voltar ao Dashboard</button>
                <button onclick="atualizarDados()" class="btn-refresh"><i class="fas fa-sync-alt"></i> Atualizar</button>
                <button onclick="exportarDados()" class="btn-export"><i class="fas fa-download"></i> Exportar</button>
            </div>
        </header>

        <div class="filters-section">
            <h2><i class="fas fa-filter"></i> Filtros de Or√ßamentos</h2>
            <div class="filters-grid">
                <div class="filter-group">
                    <label for="filtroId">ID Paciente:</label>
                    <input type="text" id="filtroId" placeholder="Digite o ID">
                </div>
                
                <div class="filter-group">
                    <label for="filtroNome">Nome do Paciente:</label>
                    <input type="text" id="filtroNome" placeholder="Digite o nome">
                </div>
                
                <div class="filter-group">
                    <label for="filtroDataInicio">Data Or√ßamento (In√≠cio):</label>
                    <input type="date" id="filtroDataInicio">
                </div>
                
                <div class="filter-group">
                    <label for="filtroDataFim">Data Or√ßamento (Fim):</label>
                    <input type="date" id="filtroDataFim">
                </div>
                
                <div class="filter-group">
                    <label for="filtroStatus">Status Or√ßamento:</label>
                    <select id="filtroStatus">
                        <option value="">Todos</option>
                        <option value="Pendente">Pendente</option>
                        <option value="Enviado">Enviado</option>
                        <option value="Aceito">Aceito</option>
                        <option value="Rejeitado">Rejeitado</option>
                        <option value="Expirado">Expirado</option>
                        <option value="Pago">Pago</option>
                        <option value="Conclu√≠do">Conclu√≠do</option>
                    </select>
                </div>
                
                <div class="filter-actions">
                    <button onclick="aplicarFiltros()" class="btn-primary"><i class="fas fa-filter"></i> Aplicar Filtros</button>
                    <button onclick="limparFiltros()" class="btn-secondary"><i class="fas fa-eraser"></i> Limpar</button>
                </div>
            </div>
        </div>

        <div class="stats-section">
            <div class="stat-card">
                <h3><i class="fas fa-file-invoice"></i> Total de Or√ßamentos</h3>
                <div class="stat-number" id="totalOrcamentos">0</div>
            </div>
            
            <div class="stat-card">
                <h3><i class="fas fa-clock"></i> Or√ßamentos Pendentes</h3>
                <div class="stat-number" id="orcamentosPendentes">0</div>
            </div>
            
            <div class="stat-card">
                <h3><i class="fas fa-check-circle"></i> Or√ßamentos Aceitos</h3>
                <div class="stat-number" id="orcamentosAceitos">0</div>
            </div>
            
            <div class="stat-card">
                <h3><i class="fas fa-dollar-sign"></i> Valor Total Pendente</h3>
                <div class="stat-number" id="valorTotalPendente">R$ 0,00</div>
            </div>
        </div>

        <div class="table-section">
            <div class="table-header">
                <h2><i class="fas fa-file-invoice-dollar"></i> Gest√£o de Or√ßamentos P√≥s-Consulta</h2>
                <div class="header-buttons">
                    <button onclick="adicionarOrcamento()" class="btn-add"><i class="fas fa-file-plus"></i> Novo Or√ßamento</button>
                    <button onclick="abrirAgendamentoRapido()" class="btn-calendar"><i class="fas fa-calendar-plus"></i> Agendamento R√°pido</button>
                    <button onclick="exportarOrcamentos()" class="btn-export"><i class="fas fa-file-excel"></i> Exportar Excel</button>
                </div>
            </div>
            
            <div class="table-container">
                <table id="tabelaGestao">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Paciente</th>
                            <th>Data Consulta</th>
                            <th>Data Or√ßamento</th>
                            <th>Procedimento</th>
                            <th>Valor Total</th>
                            <th>Status Or√ßamento</th>
                            <th>Pagamento</th>
                            <th>Vencimento</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="corpoTabela">
                        <!-- Dados ser√£o carregados via JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <div id="loading" class="loading" style="display: none;">
            Carregando dados...
        </div>
    </div>

    <!-- Modal para Novo Or√ßamento -->
    <div id="modalNovoOrcamento" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3><i class="fas fa-file-plus"></i> Novo Or√ßamento P√≥s-Consulta</h3>
                <span class="close" onclick="fecharModalOrcamento()">&times;</span>
            </div>
            
            <div class="modal-body">
                <form id="formNovoOrcamento">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="pacienteOrcamento">Paciente:</label>
                            <select id="pacienteOrcamento" required>
                                <option value="">Selecione o paciente</option>
                                <!-- Op√ß√µes carregadas dinamicamente -->
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="dataConsulta">Data da Consulta:</label>
                            <input type="date" id="dataConsulta" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="procedimentoPrincipal">Procedimento Principal:</label>
                            <select id="procedimentoPrincipal" required onchange="calcularValorTotal()">
                                <option value="">Selecione o procedimento</option>
                                <option value="rinoplastia" data-valor="8000">Rinoplastia - R$ 8.000,00</option>
                                <option value="mamoplastia" data-valor="12000">Mamoplastia de Aumento - R$ 12.000,00</option>
                                <option value="lipoaspiracao" data-valor="6000">Lipoaspira√ß√£o - R$ 6.000,00</option>
                                <option value="abdominoplastia" data-valor="10000">Abdominoplastia - R$ 10.000,00</option>
                                <option value="blefaroplastia" data-valor="5000">Blefaroplastia - R$ 5.000,00</option>
                                <option value="lifting" data-valor="15000">Lifting Facial - R$ 15.000,00</option>
                                <option value="otoplastia" data-valor="4000">Otoplastia - R$ 4.000,00</option>
                                <option value="gluteoplastia" data-valor="8000">Gluteoplastia - R$ 8.000,00</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="procedimentosAdicionais">Procedimentos Adicionais:</label>
                            <textarea id="procedimentosAdicionais" rows="3" placeholder="Descreva procedimentos complementares..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="valorProcedimento">Valor do Procedimento:</label>
                            <input type="number" id="valorProcedimento" step="0.01" required placeholder="0.00" onchange="calcularValorTotal()">
                        </div>
                        
                        <div class="form-group">
                            <label for="valorAnestesia">Valor Anestesia:</label>
                            <input type="number" id="valorAnestesia" step="0.01" placeholder="0.00" onchange="calcularValorTotal()">
                        </div>
                        
                        <div class="form-group">
                            <label for="valorHospital">Valor Hospital/Cl√≠nica:</label>
                            <input type="number" id="valorHospital" step="0.01" placeholder="0.00" onchange="calcularValorTotal()">
                        </div>
                        
                        <div class="form-group">
                            <label for="valorMaterial">Valor Material/Pr√≥tese:</label>
                            <input type="number" id="valorMaterial" step="0.01" placeholder="0.00" onchange="calcularValorTotal()">
                        </div>
                        
                        <div class="form-group">
                            <label for="valorTotal">Valor Total:</label>
                            <input type="number" id="valorTotal" step="0.01" required readonly style="background: #f0f0f0; font-weight: bold;">
                        </div>
                        
                        <div class="form-group">
                            <label for="formaPagamento">Forma de Pagamento:</label>
                            <select id="formaPagamento" required>
                                <option value="">Selecione a forma</option>
                                <option value="vista">√Ä Vista (10% desconto)</option>
                                <option value="2x">2x sem juros</option>
                                <option value="3x">3x sem juros</option>
                                <option value="6x">6x com juros (2% a.m.)</option>
                                <option value="12x">12x com juros (3% a.m.)</option>
                                <option value="financiamento">Financiamento</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="validadeOrcamento">Validade do Or√ßamento:</label>
                            <input type="date" id="validadeOrcamento" required>
                        </div>
                        
                        <div class="form-group full-width">
                            <label for="observacoesOrcamento">Observa√ß√µes:</label>
                            <textarea id="observacoesOrcamento" rows="3" placeholder="Informa√ß√µes adicionais sobre o or√ßamento..."></textarea>
                        </div>
                    </div>
                    
                    <div class="modal-actions">
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-save"></i> Salvar Or√ßamento
                        </button>
                        <button type="button" onclick="fecharModalOrcamento()" class="btn-secondary">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de A√ß√µes do Or√ßamento -->
    <div id="modalAcoesOrcamento" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3><i class="fas fa-file-invoice-dollar"></i> A√ß√µes do Or√ßamento</h3>
                <span class="close" onclick="fecharModalAcoes()">&times;</span>
            </div>
            
            <div class="modal-body">
                <div class="orcamento-info">
                    <h4 id="infoOrcamento">Or√ßamento #001 - Maria Silva</h4>
                    <div class="info-grid">
                        <div><strong>Procedimento:</strong> <span id="infoProcedimento">-</span></div>
                        <div><strong>Valor Total:</strong> <span id="infoValor">-</span></div>
                        <div><strong>Status:</strong> <span id="infoStatus">-</span></div>
                        <div><strong>Validade:</strong> <span id="infoValidade">-</span></div>
                    </div>
                </div>
                
                <div class="acoes-grid">
                    <button onclick="gerarPDFOrcamento()" class="btn-action">
                        <i class="fas fa-file-pdf"></i> Gerar PDF
                    </button>
                    
                    <button onclick="imprimirOrcamento()" class="btn-action">
                        <i class="fas fa-print"></i> Imprimir
                    </button>
                    
                    <button onclick="copiarOrcamento()" class="btn-action">
                        <i class="fas fa-copy"></i> Copiar Texto
                    </button>
                    
                    <button onclick="enviarPorEmail()" class="btn-action">
                        <i class="fas fa-envelope"></i> Enviar por Email
                    </button>
                    
                    <button onclick="marcarComoAceito()" class="btn-action success">
                        <i class="fas fa-check"></i> Marcar Aceito
                    </button>
                    
                    <button onclick="editarOrcamento()" class="btn-action">
                        <i class="fas fa-edit"></i> Editar
                    </button>
                </div>
                
                <div class="modal-actions">
                    <button type="button" onclick="fecharModalAcoes()" class="btn-secondary">
                        <i class="fas fa-times"></i> Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para agendamento r√°pido -->
    <div id="modalAgendamentoRapido" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3><i class="fas fa-calendar-plus"></i> Agendamento R√°pido</h3>
                <span class="close" onclick="fecharModalAgendamento()">&times;</span>
            </div>
            
            <div class="modal-body">
                <form id="formAgendamentoRapido">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="tipoAgendamento">Tipo de Agendamento:</label>
                            <select id="tipoAgendamento" required onchange="atualizarDuracao()">
                                <option value="">Selecione o tipo</option>
                                <option value="consulta">üë©‚Äç‚öïÔ∏è Consulta</option>
                                <option value="cirurgia">üè• Cirurgia</option>
                                <option value="reuniao">üë• Reuni√£o</option>
                                <option value="retorno">üîÑ Retorno</option>
                                <option value="avaliacao">üìã Avalia√ß√£o</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="pacienteSelect">Paciente:</label>
                            <select id="pacienteSelect" required>
                                <option value="">Selecione o paciente</option>
                                <!-- Ser√° preenchido dinamicamente -->
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="dataAgendamento">Data:</label>
                            <input type="date" id="dataAgendamento" required min="">
                        </div>
                        
                        <div class="form-group">
                            <label for="horaAgendamento">Hor√°rio:</label>
                            <select id="horaAgendamento" required>
                                <option value="">Selecione o hor√°rio</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="duracaoAgendamento">Dura√ß√£o:</label>
                            <select id="duracaoAgendamento" required>
                                <option value="30">30 minutos</option>
                                <option value="60">1 hora</option>
                                <option value="90">1h 30min</option>
                                <option value="120">2 horas</option>
                                <option value="180">3 horas</option>
                                <option value="240">4 horas</option>
                            </select>
                        </div>
                        
                        <div class="form-group full-width">
                            <label for="observacoesAgendamento">Observa√ß√µes:</label>
                            <textarea id="observacoesAgendamento" rows="3" placeholder="Motivo da consulta, prepara√ß√£o necess√°ria, etc."></textarea>
                        </div>
                    </div>
                    
                    <div class="modal-actions">
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-calendar-check"></i> Agendar
                        </button>
                        <button type="button" onclick="fecharModalAgendamento()" class="btn-secondary">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                        <button type="button" onclick="abrirCalendarioCompleto()" class="btn-calendar">
                            <i class="fas fa-calendar"></i> Calend√°rio Completo
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para edi√ß√£o -->
    <div id="modalEdicao" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Editar Paciente</h3>
                <span class="close" onclick="fecharModal()">&times;</span>
            </div>
            
            <div class="modal-body">
                <form id="formEdicao">
                    <input type="hidden" id="editId">
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="editNome">Nome:</label>
                            <input type="text" id="editNome" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="editAgendamentoData">Data Agendamento:</label>
                            <input type="date" id="editAgendamentoData">
                        </div>
                        
                        <div class="form-group">
                            <label for="editAgendamentoHora">Hora Agendamento:</label>
                            <input type="time" id="editAgendamentoHora">
                        </div>
                        
                        <div class="form-group">
                            <label for="editAgendamentoStatus">Status Agendamento:</label>
                            <select id="editAgendamentoStatus">
                                <option value="Pendente">Pendente</option>
                                <option value="Confirmado">Confirmado</option>
                                <option value="Reagendado">Reagendado</option>
                                <option value="Cancelado">Cancelado</option>
                                <option value="Realizado">Realizado</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="editConsultaStatus">Status Consulta:</label>
                            <select id="editConsultaStatus">
                                <option value="N√£o Realizada">N√£o Realizada</option>
                                <option value="Em Andamento">Em Andamento</option>
                                <option value="Conclu√≠da">Conclu√≠da</option>
                                <option value="Cancelada">Cancelada</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="editOrcamentoStatus">Status Or√ßamento:</label>
                            <select id="editOrcamentoStatus">
                                <option value="N√£o Enviado">N√£o Enviado</option>
                                <option value="Em Elabora√ß√£o">Em Elabora√ß√£o</option>
                                <option value="Enviado">Enviado</option>
                                <option value="Aceito">Aceito</option>
                                <option value="Rejeitado">Rejeitado</option>
                                <option value="Expirado">Expirado</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="editOrcamentoPdf">Link PDF Or√ßamento:</label>
                            <input type="url" id="editOrcamentoPdf" placeholder="https://...">
                        </div>
                        
                        <div class="form-group">
                            <label for="editOrcamentoAceite">Link Aceite:</label>
                            <input type="url" id="editOrcamentoAceite" placeholder="https://...">
                        </div>
                        
                        <div class="form-group">
                            <label for="editStatusAceite">Status Aceite:</label>
                            <select id="editStatusAceite">
                                <option value="Pendente">Pendente</option>
                                <option value="Aceito">Aceito</option>
                                <option value="Rejeitado">Rejeitado</option>
                                <option value="Expirado">Expirado</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="editValorEntrada">Valor Entrada:</label>
                            <input type="number" id="editValorEntrada" step="0.01" placeholder="0.00">
                        </div>
                        
                        <div class="form-group">
                            <label for="editComprovante">Comprovante Pagamento:</label>
                            <input type="url" id="editComprovante" placeholder="https://...">
                        </div>
                        
                        <div class="form-group">
                            <label for="editStatusGeral">Status Geral:</label>
                            <select id="editStatusGeral">
                                <option value="Novo">Novo</option>
                                <option value="Em Atendimento">Em Atendimento</option>
                                <option value="Aguardando Pagamento">Aguardando Pagamento</option>
                                <option value="Pago">Pago</option>
                                <option value="Conclu√≠do">Conclu√≠do</option>
                                <option value="Cancelado">Cancelado</option>
                            </select>
                        </div>
                        
                        <div class="form-group full-width">
                            <label for="editObservacao">Observa√ß√µes:</label>
                            <textarea id="editObservacao" rows="3"></textarea>
                        </div>
                    </div>
                    
                    <div class="modal-actions">
                        <button type="submit" class="btn-primary">Salvar</button>
                        <button type="button" onclick="fecharModal()" class="btn-secondary">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="gestao-script-new.js"></script>
</body>
</html>