<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caderno Digital do Paciente - Dr. Marcio Scartozzoni</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .btn-voltar {
            position: absolute;
            left: 30px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .btn-voltar:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-50%) scale(1.05);
        }

        .toolbar {
            background: #f8f9fa;
            padding: 20px 30px;
            border-bottom: 2px solid #e9ecef;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .toolbar select, .toolbar input {
            padding: 10px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            background: white;
        }

        .toolbar button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .toolbar button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            min-height: 70vh;
        }

        .sidebar {
            background: #f8f9fa;
            border-right: 2px solid #e9ecef;
            padding: 20px;
        }

        .sidebar h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #dee2e6;
        }

        .document-list {
            list-style: none;
        }

        .document-item {
            background: white;
            margin-bottom: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .document-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .document-item.active {
            border-left: 5px solid #667eea;
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
        }

        .document-header {
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .document-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }

        .document-icon.orcamento { background: #3498db; }
        .document-icon.cadastro { background: #2ecc71; }
        .document-icon.jornada { background: #e74c3c; }
        .document-icon.acompanhamento { background: #f39c12; }
        .document-icon.receita { background: #9b59b6; }
        .document-icon.exames { background: #1abc9c; }

        .document-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .btn-modelo, .btn-download {
            flex: 1;
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .btn-modelo {
            background: #e74c3c;
            color: white;
        }

        .btn-modelo:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .btn-download {
            background: #27ae60;
            color: white;
        }

        .btn-download:hover {
            background: #229954;
            transform: translateY(-2px);
        }

        .document-info h4 {
            color: #2c3e50;
            margin-bottom: 4px;
        }

        .document-info p {
            color: #7f8c8d;
            font-size: 12px;
        }

        .canvas-area {
            padding: 30px;
            background: white;
            position: relative;
            overflow: auto;
        }

        .canvas-container {
            background: #fafafa;
            border: 2px dashed #dee2e6;
            border-radius: 15px;
            min-height: 600px;
            position: relative;
            padding: 20px;
        }

        .canvas-placeholder {
            text-align: center;
            padding: 100px 20px;
            color: #7f8c8d;
        }

        .canvas-placeholder i {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .document-form {
            display: none;
            max-width: 800px;
            margin: 0 auto;
        }

        .document-form.active {
            display: block;
        }

        .form-section {
            background: white;
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .form-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 600;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .photo-upload {
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .photo-upload:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .photo-upload i {
            font-size: 3em;
            color: #667eea;
            margin-bottom: 15px;
        }

        .photo-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .photo-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .photo-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .photo-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .photo-item:hover .photo-overlay {
            opacity: 1;
        }

        .photo-actions {
            display: flex;
            gap: 10px;
        }

        .photo-actions button {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .photo-actions button:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .annotation-tools {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .tool-btn {
            background: white;
            border: 2px solid #dee2e6;
            color: #2c3e50;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tool-btn:hover,
        .tool-btn.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .evolution-timeline {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }

        .timeline-item {
            display: flex;
            margin-bottom: 25px;
            position: relative;
        }

        .timeline-item:not(:last-child)::after {
            content: '';
            position: absolute;
            left: 20px;
            top: 60px;
            bottom: -25px;
            width: 2px;
            background: #dee2e6;
        }

        .timeline-marker {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            z-index: 1;
        }

        .timeline-content {
            flex: 1;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .timeline-date {
            color: #7f8c8d;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .timeline-title {
            color: #2c3e50;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .save-btn {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 30px auto;
        }

        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(46, 204, 113, 0.3);
        }

        /* CSS para Modais */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.5em;
        }

        .btn-close {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .modal-body {
            padding: 25px;
        }

        .modal-footer {
            padding: 20px 25px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        .preset-texts {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 15px;
        }

        .preset-btn {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 14px;
        }

        .preset-btn:hover {
            background: #e9ecef;
            border-color: #667eea;
            transform: translateX(5px);
        }

        .btn-primary {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                border-right: none;
                border-bottom: 2px solid #e9ecef;
            }
            
            .btn-voltar {
                position: relative;
                left: 0;
                top: 0;
                transform: none;
                margin-bottom: 15px;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="btn-voltar" onclick="voltarDashboard()">
                <i class="fas fa-arrow-left"></i> Voltar
            </button>
            <h1><i class="fas fa-book-medical"></i> Caderno Digital do Paciente</h1>
            <p>Sistema integrado de documenta√ß√£o m√©dica com funcionalidades do GoodNotes</p>
        </div>

        <div class="toolbar">
            <select id="pacienteSelect">
                <option value="">Selecionar Paciente</option>
            </select>
            
            <input type="date" id="dataFiltro" placeholder="Filtrar por data">
            
            <button onclick="novoDocumento()">
                <i class="fas fa-plus"></i> Novo Documento
            </button>
            
            <button onclick="gerarReceita()" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
                <i class="fas fa-prescription"></i> Gerar Receita
            </button>
            
            <button onclick="gerarExames()" style="background: linear-gradient(135deg, #17a2b8 0%, #20c997 100%);">
                <i class="fas fa-vial"></i> Gerar Exames
            </button>
            
            <button onclick="capturarFoto()">
                <i class="fas fa-camera"></i> Capturar Foto
            </button>
            
            <button onclick="exportarPDF()">
                <i class="fas fa-file-pdf"></i> Exportar PDF
            </button>
            
            <button onclick="sincronizar()">
                <i class="fas fa-sync"></i> Sincronizar
            </button>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <h3><i class="fas fa-folder"></i> Documentos</h3>
                <ul class="document-list">
                    <li class="document-item active" onclick="abrirDocumento('orcamento')">
                        <div class="document-header">
                            <div class="document-icon orcamento">
                                <i class="fas fa-calculator"></i>
                            </div>
                            <div class="document-info">
                                <h4>Or√ßamento Cir√∫rgico</h4>
                                <p>Valores e formas de pagamento</p>
                            </div>
                        </div>
                    </li>
                    
                    <li class="document-item" onclick="abrirDocumento('cadastro')">
                        <div class="document-header">
                            <div class="document-icon cadastro">
                                <i class="fas fa-user-plus"></i>
                            </div>
                            <div class="document-info">
                                <h4>Dados do Paciente</h4>
                                <p>Cadastro completo</p>
                            </div>
                        </div>
                    </li>
                    
                    <li class="document-item" onclick="abrirDocumento('jornada')">
                        <div class="document-header">
                            <div class="document-icon jornada">
                                <i class="fas fa-route"></i>
                            </div>
                            <div class="document-info">
                                <h4>Caderno de Jornada</h4>
                                <p>Acompanhamento evolutivo</p>
                            </div>
                        </div>
                    </li>
                    
                    <li class="document-item" onclick="abrirDocumento('acompanhamento')">
                        <div class="document-header">
                            <div class="document-icon acompanhamento">
                                <i class="fas fa-heartbeat"></i>
                            </div>
                            <div class="document-info">
                                <h4>Acompanhamento</h4>
                                <p>Follow-up p√≥s-operat√≥rio</p>
                            </div>
                        </div>
                    </li>
                    
                    <li class="document-item" onclick="abrirDocumento('receita')">
                        <div class="document-header">
                            <div class="document-icon receita">
                                <i class="fas fa-prescription-bottle-alt"></i>
                            </div>
                            <div class="document-info">
                                <h4>Receitas</h4>
                                <p>Prescri√ß√µes m√©dicas</p>
                            </div>
                        </div>
                    </li>
                    
                    <li class="document-item" onclick="abrirDocumento('exames')">
                        <div class="document-header">
                            <div class="document-icon exames">
                                <i class="fas fa-vials"></i>
                            </div>
                            <div class="document-info">
                                <h4>Pedido de Exames</h4>
                                <p>Solicita√ß√µes laboratoriais</p>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>

            <div class="canvas-area">
                <!-- Placeholder inicial -->
                <div class="canvas-placeholder" id="placeholder">
                    <i class="fas fa-book-open"></i>
                    <h3>Selecione um documento para come√ßar</h3>
                    <p>Escolha um tipo de documento no menu lateral</p>
                </div>

                <!-- Formul√°rio de Or√ßamento -->
                <div class="document-form" id="orcamento-form">
                    <div class="form-section">
                        <h3><i class="fas fa-calculator"></i> Or√ßamento Cir√∫rgico</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Nome Completo</label>
                                <input type="text" id="orcamento-nome" placeholder="Nome do paciente">
                            </div>
                            <div class="form-group">
                                <label>Cirurgia</label>
                                <input type="text" id="orcamento-cirurgia" placeholder="Tipo de cirurgia">
                            </div>
                            <div class="form-group">
                                <label>Valor Cl√≠nica</label>
                                <input type="number" id="orcamento-valor-clinica" placeholder="0,00">
                            </div>
                            <div class="form-group">
                                <label>Valor Hospital</label>
                                <input type="number" id="orcamento-valor-hospital" placeholder="0,00">
                            </div>
                        </div>
                        
                        <h4>Forma de Pagamento</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>
                                    <input type="radio" name="pagamento" value="vista"> 
                                    Pagamento √† vista (3% desconto)
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="radio" name="pagamento" value="3x"> 
                                    Em at√© 3x (5% acr√©scimo)
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="radio" name="pagamento" value="10x"> 
                                    Em at√© 10x (10% acr√©scimo)
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Hospital</label>
                            <input type="text" id="orcamento-hospital" placeholder="Hospital onde ser√° realizada">
                        </div>
                        
                        <div class="form-group">
                            <label>Observa√ß√µes</label>
                            <textarea id="orcamento-obs" rows="4" placeholder="Informa√ß√µes adicionais"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Modelo de Or√ßamento</label>
                            <div class="document-actions">
                                <button type="button" onclick="visualizarOrcamentoModelo()" class="btn-modelo">
                                    <i class="fas fa-file-pdf"></i> Ver Modelo PDF
                                </button>
                                <button type="button" onclick="baixarOrcamentoModelo()" class="btn-download">
                                    <i class="fas fa-download"></i> Baixar Modelo
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Formul√°rio de Cadastro -->
                <div class="document-form" id="cadastro-form">
                    <div class="form-section">
                        <h3><i class="fas fa-user-plus"></i> Dados do Paciente</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Nome Completo</label>
                                <input type="text" id="cadastro-nome" placeholder="Nome completo">
                            </div>
                            <div class="form-group">
                                <label>CPF</label>
                                <input type="text" id="cadastro-cpf" placeholder="000.000.000-00">
                            </div>
                            <div class="form-group">
                                <label>Data de Nascimento</label>
                                <input type="date" id="cadastro-nascimento">
                            </div>
                            <div class="form-group">
                                <label>E-mail</label>
                                <input type="email" id="cadastro-email" placeholder="email@exemplo.com">
                            </div>
                            <div class="form-group">
                                <label>Celular</label>
                                <input type="tel" id="cadastro-celular" placeholder="(11) 99999-9999">
                            </div>
                            <div class="form-group">
                                <label>Telefone</label>
                                <input type="tel" id="cadastro-telefone" placeholder="(11) 3333-3333">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Endere√ßo Completo</label>
                            <textarea id="cadastro-endereco" rows="3" placeholder="Rua, n√∫mero, complemento, bairro, cidade, CEP"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Caderno de Jornada -->
                <div class="document-form" id="jornada-form">
                    <div class="form-section">
                        <h3><i class="fas fa-route"></i> Caderno de Jornada - Acompanhamento Evolutivo</h3>
                        
                        <div class="annotation-tools">
                            <button class="tool-btn active" onclick="selecionarFerramenta('texto')">
                                <i class="fas fa-font"></i> Texto
                            </button>
                            <button class="tool-btn" onclick="selecionarFerramenta('desenho')">
                                <i class="fas fa-pencil-alt"></i> Desenho
                            </button>
                            <button class="tool-btn" onclick="selecionarFerramenta('regua')">
                                <i class="fas fa-ruler"></i> R√©gua
                            </button>
                            <button class="tool-btn" onclick="selecionarFerramenta('marca')">
                                <i class="fas fa-highlighter"></i> Marcador
                            </button>
                            <button class="tool-btn" onclick="selecionarFerramenta('foto')">
                                <i class="fas fa-camera"></i> Foto
                            </button>
                        </div>
                        
                        <div class="evolution-timeline">
                            <h4>Timeline de Evolu√ß√£o</h4>
                            <div class="timeline-item">
                                <div class="timeline-marker">
                                    <i class="fas fa-plus"></i>
                                </div>
                                <div class="timeline-content">
                                    <div class="timeline-date">29/07/2025 - 10:30</div>
                                    <div class="timeline-title">Consulta Inicial</div>
                                    <p>Avalia√ß√£o inicial do paciente. Estado geral bom, sem comorbidades significativas.</p>
                                </div>
                            </div>
                            
                            <div class="timeline-item">
                                <div class="timeline-marker">
                                    <i class="fas fa-stethoscope"></i>
                                </div>
                                <div class="timeline-content">
                                    <div class="timeline-date">02/08/2025 - 14:00</div>
                                    <div class="timeline-title">Pr√©-operat√≥rio</div>
                                    <p>Exames pr√©-operat√≥rios realizados. Paciente apto para cirurgia.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Nova Evolu√ß√£o</label>
                            <textarea id="nova-evolucao" rows="4" placeholder="Descreva a evolu√ß√£o do paciente..."></textarea>
                            <button type="button" onclick="adicionarEvolucao()" style="margin-top: 10px; background: #2ecc71; color: white; border: none; padding: 10px 20px; border-radius: 5px;">
                                <i class="fas fa-plus"></i> Adicionar Evolu√ß√£o
                            </button>
                        </div>
                        
                        <div class="photo-upload" onclick="document.getElementById('foto-input').click()">
                            <i class="fas fa-camera"></i>
                            <h4>Capturar ou Adicionar Foto</h4>
                            <p>Clique para capturar uma foto ou selecionar da galeria</p>
                            <input type="file" id="foto-input" accept="image/*" style="display: none;" onchange="adicionarFoto(this)">
                        </div>
                        
                        <div class="photo-gallery" id="galeria-fotos">
                            <!-- Fotos ser√£o adicionadas aqui dinamicamente -->
                        </div>
                    </div>
                </div>

                <!-- Outros formul√°rios similares para acompanhamento, receita, exames -->
                <div class="document-form" id="acompanhamento-form">
                    <div class="form-section">
                        <h3><i class="fas fa-heartbeat"></i> Formul√°rio de Acompanhamento</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Data da Consulta</label>
                                <input type="date" id="acomp-data">
                            </div>
                            <div class="form-group">
                                <label>Peso Atual</label>
                                <input type="number" id="acomp-peso" placeholder="kg">
                            </div>
                            <div class="form-group">
                                <label>Press√£o Arterial</label>
                                <input type="text" id="acomp-pressao" placeholder="120/80">
                            </div>
                            <div class="form-group">
                                <label>Sintomas</label>
                                <textarea id="acomp-sintomas" rows="3" placeholder="Descreva sintomas ou queixas"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="document-form" id="receita-form">
                    <div class="form-section">
                        <h3><i class="fas fa-prescription-bottle-alt"></i> Receita M√©dica</h3>
                        <div class="form-group">
                            <label>Medicamentos Prescritos</label>
                            <textarea id="receita-medicamentos" rows="6" placeholder="1. Medicamento - Posologia - Dura√ß√£o&#10;2. Medicamento - Posologia - Dura√ß√£o"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Orienta√ß√µes Gerais</label>
                            <textarea id="receita-orientacoes" rows="4" placeholder="Orienta√ß√µes adicionais para o paciente"></textarea>
                        </div>
                    </div>
                </div>

                <div class="document-form" id="exames-form">
                    <div class="form-section">
                        <h3><i class="fas fa-vials"></i> Pedido de Exames</h3>
                        <div class="form-group">
                            <label>Exames Solicitados</label>
                            <textarea id="exames-lista" rows="6" placeholder="Liste os exames solicitados:&#10;- Hemograma completo&#10;- Glicemia de jejum&#10;- etc."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Justificativa</label>
                            <textarea id="exames-justificativa" rows="3" placeholder="Justificativa cl√≠nica para os exames"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <button class="save-btn" onclick="salvarDocumento()">
            <i class="fas fa-save"></i> Salvar Documento
        </button>
    </div>

    <!-- Modal para Gerar Receita -->
    <div id="modal-receita" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 900px; width: 90%;">
            <div class="modal-header">
                <h2><i class="fas fa-prescription"></i> Gerar Receita M√©dica</h2>
                <button onclick="fecharModal('modal-receita')" class="btn-close">√ó</button>
            </div>
            
            <div class="modal-body">
                <div style="display: flex; gap: 20px;">
                    <!-- √Årea principal de edi√ß√£o -->
                    <div style="flex: 2;">
                        <div class="form-group">
                            <label>Prescri√ß√£o:</label>
                            <textarea id="receita-texto" rows="15" 
                                style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-family: 'Courier New', monospace;"
                                placeholder="Digite a prescri√ß√£o m√©dica aqui...&#10;&#10;Exemplo:&#10;1. Dipirona 500mg - Tomar 1 comprimido de 6/6h por 5 dias&#10;2. Omeprazol 20mg - Tomar 1 c√°psula em jejum por 7 dias"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Orienta√ß√µes Gerais:</label>
                            <textarea id="receita-orientacoes" rows="3" 
                                style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;"
                                placeholder="Orienta√ß√µes adicionais ao paciente..."></textarea>
                        </div>
                    </div>
                    
                    <!-- Textos pr√©-configurados -->
                    <div style="flex: 1;">
                        <h4>üìù Textos Pr√©-configurados</h4>
                        <div class="preset-texts">
                            <button onclick="inserirTextoReceita('antibiotico')" class="preset-btn">Antibi√≥tico</button>
                            <button onclick="inserirTextoReceita('analgesia')" class="preset-btn">Analgesia</button>
                            <button onclick="inserirTextoReceita('anti-inflamatorio')" class="preset-btn">Anti-inflamat√≥rio</button>
                            <button onclick="inserirTextoReceita('pos-operatorio')" class="preset-btn">P√≥s-operat√≥rio</button>
                            <button onclick="inserirTextoReceita('vitaminas')" class="preset-btn">Vitaminas</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button onclick="assinarDigitalmente('receita')" class="btn-primary" style="background: #28a745;">
                    <i class="fas fa-signature"></i> Assinar Digitalmente (VIDAAS)
                </button>
                <button onclick="gerarPDFReceita()" class="btn-primary" style="background: #dc3545;">
                    <i class="fas fa-file-pdf"></i> Gerar PDF
                </button>
                <button onclick="imprimirReceita()" class="btn-primary" style="background: #6f42c1;">
                    <i class="fas fa-print"></i> Imprimir
                </button>
                <button onclick="enviarPorEmail('receita')" class="btn-secondary">
                    <i class="fas fa-envelope"></i> Enviar por Email
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para Gerar Exames -->
    <div id="modal-exames" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 900px; width: 90%;">
            <div class="modal-header">
                <h2><i class="fas fa-vial"></i> Gerar Solicita√ß√£o de Exames</h2>
                <button onclick="fecharModal('modal-exames')" class="btn-close">√ó</button>
            </div>
            
            <div class="modal-body">
                <div style="display: flex; gap: 20px;">
                    <!-- √Årea principal de edi√ß√£o -->
                    <div style="flex: 2;">
                        <div class="form-group">
                            <label>Exames Solicitados:</label>
                            <textarea id="exames-texto" rows="12" 
                                style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-family: 'Courier New', monospace;"
                                placeholder="Digite os exames solicitados...&#10;&#10;Exemplo:&#10;‚ñ° Hemograma completo&#10;‚ñ° Glicemia de jejum&#10;‚ñ° Colesterol total e fra√ß√µes&#10;‚ñ° Ureia e creatinina"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Justificativa Cl√≠nica:</label>
                            <textarea id="exames-justificativa" rows="3" 
                                style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;"
                                placeholder="Justificativa para solicita√ß√£o dos exames..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>CID-10:</label>
                            <input type="text" id="exames-cid" 
                                style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;"
                                placeholder="Ex: Z01.0 - Exame m√©dico geral">
                        </div>
                    </div>
                    
                    <!-- Exames pr√©-configurados -->
                    <div style="flex: 1;">
                        <h4>üß™ Exames Pr√©-configurados</h4>
                        <div class="preset-texts">
                            <button onclick="inserirTextoExames('rotina')" class="preset-btn">Check-up Rotina</button>
                            <button onclick="inserirTextoExames('pre-operatorio')" class="preset-btn">Pr√©-operat√≥rio</button>
                            <button onclick="inserirTextoExames('cardiologico')" class="preset-btn">Cardiol√≥gico</button>
                            <button onclick="inserirTextoExames('diabetes')" class="preset-btn">Diabetes</button>
                            <button onclick="inserirTextoExames('tireoide')" class="preset-btn">Tireoide</button>
                            <button onclick="inserirTextoExames('hepatico')" class="preset-btn">Fun√ß√£o Hep√°tica</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button onclick="assinarDigitalmente('exames')" class="btn-primary" style="background: #28a745;">
                    <i class="fas fa-signature"></i> Assinar Digitalmente (VIDAAS)
                </button>
                <button onclick="gerarPDFExames()" class="btn-primary" style="background: #dc3545;">
                    <i class="fas fa-file-pdf"></i> Gerar PDF
                </button>
                <button onclick="imprimirExames()" class="btn-primary" style="background: #6f42c1;">
                    <i class="fas fa-print"></i> Imprimir
                </button>
                <button onclick="enviarPorEmail('exames')" class="btn-secondary">
                    <i class="fas fa-envelope"></i> Enviar por Email
                </button>
            </div>
        </div>
    </div>

    <script src="caderno-digital-functions.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        let documentoAtivo = 'orcamento';
        let ferramentaAtiva = 'texto';
        let fotos = [];

        function voltarDashboard() {
            window.location.href = 'dashboard.html';
        }

        function abrirDocumento(tipo) {
            // Remove classe active de todos os itens
            document.querySelectorAll('.document-item').forEach(item => {
                item.classList.remove('active');
            });

            // Adiciona active ao item clicado
            event.currentTarget.classList.add('active');

            // Oculta todos os formul√°rios
            document.querySelectorAll('.document-form').forEach(form => {
                form.classList.remove('active');
            });

            // Oculta placeholder
            document.getElementById('placeholder').style.display = 'none';

            // Mostra formul√°rio espec√≠fico
            document.getElementById(tipo + '-form').classList.add('active');
            documentoAtivo = tipo;
        }

        function selecionarFerramenta(ferramenta) {
            document.querySelectorAll('.tool-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            ferramentaAtiva = ferramenta;

            // Implementar l√≥gica espec√≠fica de cada ferramenta
            console.log('Ferramenta selecionada:', ferramenta);
        }

        function adicionarFoto(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const fotoData = {
                        id: Date.now(),
                        src: e.target.result,
                        nome: file.name,
                        data: new Date().toLocaleString('pt-BR')
                    };
                    
                    fotos.push(fotoData);
                    renderizarGaleria();
                };
                reader.readAsDataURL(file);
            }
        }

        function renderizarGaleria() {
            const galeria = document.getElementById('galeria-fotos');
            galeria.innerHTML = '';

            fotos.forEach(foto => {
                const item = document.createElement('div');
                item.className = 'photo-item';
                item.innerHTML = `
                    <img src="${foto.src}" alt="${foto.nome}">
                    <div class="photo-overlay">
                        <div class="photo-actions">
                            <button onclick="editarFoto(${foto.id})" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="adicionarAnotacao(${foto.id})" title="Anotar">
                                <i class="fas fa-pencil-alt"></i>
                            </button>
                            <button onclick="removerFoto(${foto.id})" title="Remover">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                galeria.appendChild(item);
            });
        }

        function capturarFoto() {
            cadernoDigital.capturarFoto();
        }

        function selecionarFerramenta(ferramenta) {
            document.querySelectorAll('.tool-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            cadernoDigital.ativarFerramenta(ferramenta);
        }

        function exportarPDF() {
            cadernoDigital.exportarPDF();
        }

        function sincronizar() {
            cadernoDigital.sincronizarDados();
        }

        function adicionarFoto(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const fotoData = {
                        id: Date.now(),
                        src: e.target.result,
                        nome: file.name,
                        timestamp: new Date().toISOString()
                    };
                    
                    cadernoDigital.fotos.push(fotoData);
                    cadernoDigital.renderizarGaleria();
                };
                reader.readAsDataURL(file);
            }
        }

        function adicionarEvolucao() {
            const textoEvolucao = document.getElementById('nova-evolucao').value;
            if (textoEvolucao.trim()) {
                const timeline = document.querySelector('.evolution-timeline');
                const novaEvolucao = document.createElement('div');
                novaEvolucao.className = 'timeline-item';
                novaEvolucao.innerHTML = `
                    <div class="timeline-marker">
                        <i class="fas fa-notes-medical"></i>
                    </div>
                    <div class="timeline-content">
                        <div class="timeline-date">${new Date().toLocaleString('pt-BR')}</div>
                        <div class="timeline-title">Nova Evolu√ß√£o</div>
                        <p>${textoEvolucao}</p>
                    </div>
                `;
                timeline.appendChild(novaEvolucao);
                document.getElementById('nova-evolucao').value = '';
            }
        }

        function editarFoto(id) {
            console.log('Editando foto:', id);
            // Implementar editor de imagem
        }

        function adicionarAnotacao(id) {
            console.log('Adicionando anota√ß√£o √† foto:', id);
            // Implementar sistema de anota√ß√µes
        }

        function removerFoto(id) {
            fotos = fotos.filter(foto => foto.id !== id);
            renderizarGaleria();
        }

        function novoDocumento() {
            if (confirm('Criar novo documento? Os dados n√£o salvos ser√£o perdidos.')) {
                document.querySelectorAll('input, textarea').forEach(field => {
                    field.value = '';
                });
                fotos = [];
                renderizarGaleria();
            }
        }

        function salvarDocumento() {
            const dadosDocumento = {
                tipo: documentoAtivo,
                data: new Date().toISOString(),
                dados: {},
                fotos: fotos
            };

            // Coletar dados espec√≠ficos do documento ativo
            const formulario = document.getElementById(documentoAtivo + '-form');
            const campos = formulario.querySelectorAll('input, textarea, select');
            
            campos.forEach(campo => {
                if (campo.type === 'radio') {
                    if (campo.checked) {
                        dadosDocumento.dados[campo.name] = campo.value;
                    }
                } else {
                    dadosDocumento.dados[campo.id] = campo.value;
                }
            });

            // Salvar no localStorage (em produ√ß√£o, enviar para servidor)
            const documentosSalvos = JSON.parse(localStorage.getItem('cadernoDigital') || '[]');
            documentosSalvos.push(dadosDocumento);
            localStorage.setItem('cadernoDigital', JSON.stringify(documentosSalvos));

            alert('Documento salvo com sucesso!');
        }

        function exportarPDF() {
            alert('Exportando para PDF... (Funcionalidade em desenvolvimento)');
        }

        function sincronizar() {
            alert('Sincronizando com o servidor... (Funcionalidade em desenvolvimento)');
        }

        // === FUN√á√ïES PARA RECEITA M√âDICA ===
        function gerarReceita() {
            document.getElementById('modal-receita').style.display = 'flex';
        }

        function gerarExames() {
            document.getElementById('modal-exames').style.display = 'flex';
        }

        function fecharModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Textos pr√©-configurados para receitas
        const textosReceita = {
            antibiotico: `1. Amoxicilina 500mg - Tomar 1 c√°psula de 8/8h por 7 dias
2. Omeprazol 20mg - Tomar 1 c√°psula em jejum por 7 dias (protetor g√°strico)`,
            
            analgesia: `1. Dipirona 500mg - Tomar 1 comprimido de 6/6h se dor (m√°ximo 4x/dia)
2. Paracetamol 750mg - Tomar 1 comprimido de 8/8h se necess√°rio`,
            
            'anti-inflamatorio': `1. Ibuprofeno 600mg - Tomar 1 comprimido de 8/8h por 5 dias (ap√≥s alimenta√ß√£o)
2. Omeprazol 20mg - Tomar 1 c√°psula em jejum por 7 dias`,
            
            'pos-operatorio': `1. Dipirona 500mg - Tomar 1 comprimido de 6/6h por 3 dias
2. Amoxicilina + Clavulanato 875mg - Tomar 1 comprimido de 12/12h por 7 dias
3. Omeprazol 20mg - Tomar 1 c√°psula em jejum por 7 dias
4. Aplicar gelo local 15min de 4/4h nas primeiras 48h`,
            
            vitaminas: `1. Complexo B - Tomar 1 comprimido ao dia por 30 dias
2. Vitamina D3 2000UI - Tomar 1 c√°psula ao dia por 30 dias
3. Vitamina C 1g - Tomar 1 comprimido ao dia por 30 dias`
        };

        // Textos pr√©-configurados para exames
        const textosExames = {
            rotina: `‚ñ° Hemograma completo
‚ñ° Glicemia de jejum
‚ñ° Colesterol total e fra√ß√µes
‚ñ° Triglicer√≠deos
‚ñ° Ureia e creatinina
‚ñ° TGO e TGP
‚ñ° Urina tipo 1`,
            
            'pre-operatorio': `‚ñ° Hemograma completo
‚ñ° Coagulograma (TAP/PTT)
‚ñ° Glicemia de jejum
‚ñ° Ureia e creatinina
‚ñ° S√≥dio e pot√°ssio
‚ñ° ECG
‚ñ° Raio-X de t√≥rax`,
            
            cardiologico: `‚ñ° ECG de repouso
‚ñ° Ecocardiograma
‚ñ° Teste ergom√©trico
‚ñ° Colesterol total e fra√ß√µes
‚ñ° Triglicer√≠deos
‚ñ° PCR ultrassens√≠vel`,
            
            diabetes: `‚ñ° Glicemia de jejum
‚ñ° Hemoglobina glicada (HbA1c)
‚ñ° Insulina de jejum
‚ñ° Pept√≠deo C
‚ñ° Microalbumin√∫ria
‚ñ° Fundo de olho`,
            
            tireoide: `‚ñ° TSH
‚ñ° T4 livre
‚ñ° T3 livre
‚ñ° Anti-TPO
‚ñ° Anti-tireoglobulina
‚ñ° Ultrassom de tireoide`,
            
            hepatico: `‚ñ° TGO (AST)
‚ñ° TGP (ALT)
‚ñ° GGT
‚ñ° Fosfatase alcalina
‚ñ° Bilirrubinas (total e fra√ß√µes)
‚ñ° Albumina`
        };

        function inserirTextoReceita(tipo) {
            const textarea = document.getElementById('receita-texto');
            const textoAtual = textarea.value;
            const novoTexto = textosReceita[tipo];
            
            if (textoAtual.trim() === '') {
                textarea.value = novoTexto;
            } else {
                textarea.value = textoAtual + '\n\n' + novoTexto;
            }
            
            // Focar no textarea
            textarea.focus();
            textarea.setSelectionRange(textarea.value.length, textarea.value.length);
        }

        function inserirTextoExames(tipo) {
            const textarea = document.getElementById('exames-texto');
            const textoAtual = textarea.value;
            const novoTexto = textosExames[tipo];
            
            if (textoAtual.trim() === '') {
                textarea.value = novoTexto;
            } else {
                textarea.value = textoAtual + '\n\n' + novoTexto;
            }
            
            // Focar no textarea
            textarea.focus();
            textarea.setSelectionRange(textarea.value.length, textarea.value.length);
        }

        // Fun√ß√£o para assinatura digital via VIDAAS
        function assinarDigitalmente(tipo) {
            try {
                // Tentar abrir o VIDAAS
                const vidaasUrl = 'vidaas://assinar';
                
                // Criar link tempor√°rio para abrir o app
                const link = document.createElement('a');
                link.href = vidaasUrl;
                link.click();
                
                // Fallback: se n√£o conseguir abrir o app, mostrar instru√ß√µes
                setTimeout(() => {
                    const confirmar = confirm(`üì± Tentando abrir o VIDAAS para assinatura digital...

Se o aplicativo n√£o abriu automaticamente:
1. Abra o VIDAAS manualmente
2. Selecione o documento de ${tipo}
3. Realize a assinatura digital

Deseja continuar com a gera√ß√£o do PDF ap√≥s assinar?`);
                    
                    if (confirmar) {
                        if (tipo === 'receita') {
                            gerarPDFReceita();
                        } else {
                            gerarPDFExames();
                        }
                    }
                }, 1000);
                
            } catch (error) {
                alert('‚ùå Erro ao tentar abrir o VIDAAS. Abra o aplicativo manualmente para assinar o documento.');
                console.error('Erro:', error);
            }
        }

        // Fun√ß√£o para gerar PDF da receita
        function gerarPDFReceita() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Cabe√ßalho
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.text('RECEITA M√âDICA', 105, 30, { align: 'center' });
            
            // Dados do m√©dico
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            doc.text('Dr. Marcio Scartozzoni', 20, 50);
            doc.text('CRM: [N√öMERO]', 20, 60);
            doc.text('Especialidade: [ESPECIALIDADE]', 20, 70);
            
            // Data
            const hoje = new Date().toLocaleDateString('pt-BR');
            doc.text(`Data: ${hoje}`, 150, 50);
            
            // Paciente
            const pacienteSelecionado = document.getElementById('pacienteSelect').value;
            doc.text(`Paciente: ${pacienteSelecionado || '[Nome do Paciente]'}`, 20, 90);
            
            // Prescri√ß√£o
            doc.setFont(undefined, 'bold');
            doc.text('PRESCRI√á√ÉO:', 20, 110);
            
            doc.setFont(undefined, 'normal');
            const prescricao = document.getElementById('receita-texto').value || '[Prescri√ß√£o n√£o informada]';
            const linhasPrescricao = doc.splitTextToSize(prescricao, 170);
            doc.text(linhasPrescricao, 20, 125);
            
            // Orienta√ß√µes
            const orientacoes = document.getElementById('receita-orientacoes').value;
            if (orientacoes) {
                doc.setFont(undefined, 'bold');
                doc.text('ORIENTA√á√ïES:', 20, 125 + (linhasPrescricao.length * 7) + 15);
                
                doc.setFont(undefined, 'normal');
                const linhasOrientacoes = doc.splitTextToSize(orientacoes, 170);
                doc.text(linhasOrientacoes, 20, 125 + (linhasPrescricao.length * 7) + 30);
            }
            
            // Assinatura
            doc.setFont(undefined, 'bold');
            doc.text('_________________________________', 20, 250);
            doc.text('Dr. Marcio Scartozzoni', 20, 260);
            doc.text('CRM: [N√öMERO]', 20, 270);
            
            // Gerar e abrir PDF
            const pdfBlob = doc.output('blob');
            const pdfUrl = URL.createObjectURL(pdfBlob);
            window.open(pdfUrl, '_blank');
            
            alert('‚úÖ PDF da receita gerado com sucesso!');
        }

        // Fun√ß√£o para gerar PDF dos exames
        function gerarPDFExames() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Cabe√ßalho
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.text('SOLICITA√á√ÉO DE EXAMES', 105, 30, { align: 'center' });
            
            // Dados do m√©dico
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            doc.text('Dr. Marcio Scartozzoni', 20, 50);
            doc.text('CRM: [N√öMERO]', 20, 60);
            doc.text('Especialidade: [ESPECIALIDADE]', 20, 70);
            
            // Data
            const hoje = new Date().toLocaleDateString('pt-BR');
            doc.text(`Data: ${hoje}`, 150, 50);
            
            // Paciente
            const pacienteSelecionado = document.getElementById('pacienteSelect').value;
            doc.text(`Paciente: ${pacienteSelecionado || '[Nome do Paciente]'}`, 20, 90);
            
            // CID
            const cid = document.getElementById('exames-cid').value;
            if (cid) {
                doc.text(`CID-10: ${cid}`, 20, 100);
            }
            
            // Exames solicitados
            doc.setFont(undefined, 'bold');
            doc.text('EXAMES SOLICITADOS:', 20, 120);
            
            doc.setFont(undefined, 'normal');
            const exames = document.getElementById('exames-texto').value || '[Exames n√£o informados]';
            const linhasExames = doc.splitTextToSize(exames, 170);
            doc.text(linhasExames, 20, 135);
            
            // Justificativa
            const justificativa = document.getElementById('exames-justificativa').value;
            if (justificativa) {
                doc.setFont(undefined, 'bold');
                doc.text('JUSTIFICATIVA CL√çNICA:', 20, 135 + (linhasExames.length * 7) + 15);
                
                doc.setFont(undefined, 'normal');
                const linhasJustificativa = doc.splitTextToSize(justificativa, 170);
                doc.text(linhasJustificativa, 20, 135 + (linhasExames.length * 7) + 30);
            }
            
            // Assinatura
            doc.setFont(undefined, 'bold');
            doc.text('_________________________________', 20, 250);
            doc.text('Dr. Marcio Scartozzoni', 20, 260);
            doc.text('CRM: [N√öMERO]', 20, 270);
            
            // Gerar e abrir PDF
            const pdfBlob = doc.output('blob');
            const pdfUrl = URL.createObjectURL(pdfBlob);
            window.open(pdfUrl, '_blank');
            
            alert('‚úÖ PDF da solicita√ß√£o de exames gerado com sucesso!');
        }

        // Fun√ß√£o para imprimir receita
        function imprimirReceita() {
            gerarPDFReceita();
            setTimeout(() => {
                window.print();
            }, 1000);
        }

        // Fun√ß√£o para imprimir exames
        function imprimirExames() {
            gerarPDFExames();
            setTimeout(() => {
                window.print();
            }, 1000);
        }

        // Fun√ß√£o para enviar por email
        function enviarPorEmail(tipo) {
            const assunto = tipo === 'receita' ? 'Receita M√©dica' : 'Solicita√ß√£o de Exames';
            const paciente = document.getElementById('pacienteSelect').value || '[Nome do Paciente]';
            
            const corpo = `Ol√°,

Segue em anexo ${tipo === 'receita' ? 'a receita m√©dica' : 'a solicita√ß√£o de exames'} para o paciente: ${paciente}

Data: ${new Date().toLocaleDateString('pt-BR')}

Atenciosamente,
Dr. Marcio Scartozzoni`;

            // Abrir cliente de email
            const mailtoLink = `mailto:?subject=${encodeURIComponent(assunto)}&body=${encodeURIComponent(corpo)}`;
            window.location.href = mailtoLink;
            
            alert(`üìß Cliente de email aberto. Anexe o PDF da ${tipo} antes de enviar.`);
        }

        // Fechar modais clicando fora
        window.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal-overlay')) {
                event.target.style.display = 'none';
            }
        });

        // Fun√ß√µes para o modelo de or√ßamento
        function visualizarOrcamentoModelo() {
            // Abrir o PDF em uma nova aba
            window.open('/public/docs/Orcamento.pdf', '_blank');
        }

        function baixarOrcamentoModelo() {
            // Criar link de download
            const link = document.createElement('a');
            link.href = '/public/docs/Orcamento.pdf';
            link.download = 'Modelo_Orcamento_Dr_Marcio.pdf';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Carregar pacientes ao inicializar
        // Verifica√ß√£o de autentica√ß√£o
        function checkAuth() {
            const userInfo = localStorage.getItem('userInfo');
            
            if (!userInfo) {
                console.log('‚ùå Nenhuma sess√£o encontrada - redirecionando para login');
                window.location.href = '/login.html';
                return false;
            }
            
            const user = JSON.parse(userInfo);
            console.log('üë§ Usu√°rio logado:', user.nome, '| Tipo:', user.tipo, '| Autorizado:', user.autorizado);
            
            // Verificar se funcion√°rio est√° autorizado
            if (user.tipo === 'funcionario' && !user.autorizado) {
                console.log('‚õî Funcion√°rio n√£o autorizado - redirecionando para login');
                alert('‚ö†Ô∏è Seu acesso ainda n√£o foi autorizado pelo administrador.\n\nVoc√™ ser√° redirecionado para a tela de login.');
                localStorage.removeItem('userInfo');
                window.location.href = '/login.html';
                return false;
            }
            
            return true;
        }

        window.onload = function() {
            // Verificar autoriza√ß√£o primeiro
            if (!checkAuth()) {
                return; // N√£o continuar carregamento se n√£o autorizado
            }
            
            // Inicializar caderno digital
            cadernoDigital.inicializar();
            
            // Verificar se existe paciente vindo da Gest√£o
            const pacienteDaGestao = localStorage.getItem('pacienteCaderno');
            
            // Simular carregamento de pacientes
            const pacientes = [
                'Jo√£o Silva',
                'Maria Santos', 
                'Pedro Oliveira',
                'Ana Costa'
            ];

            const select = document.getElementById('pacienteSelect');
            
            // Se veio da gest√£o, adicionar o paciente no topo da lista
            if (pacienteDaGestao) {
                const dadosPaciente = JSON.parse(pacienteDaGestao);
                
                // Criar op√ß√£o para o paciente da gest√£o
                const optionGestao = document.createElement('option');
                optionGestao.value = dadosPaciente.nome;
                optionGestao.textContent = `${dadosPaciente.nome} (ID: ${dadosPaciente.id})`;
                optionGestao.selected = true;
                select.appendChild(optionGestao);
                
                // Mostrar informa√ß√µes do paciente
                mostrarInfoPacienteGestao(dadosPaciente);
                
                // Limpar dados do localStorage ap√≥s uso
                localStorage.removeItem('pacienteCaderno');
            }

            pacientes.forEach(paciente => {
                const option = document.createElement('option');
                option.value = paciente;
                option.textContent = paciente;
                select.appendChild(option);
            });
        };
        
        // Fun√ß√£o para mostrar informa√ß√µes do paciente da gest√£o
        function mostrarInfoPacienteGestao(dadosPaciente) {
            // Adicionar uma notifica√ß√£o visual no topo do caderno
            const infoDiv = document.createElement('div');
            infoDiv.className = 'paciente-gestao-info';
            infoDiv.innerHTML = `
                <div style="background: #e8f5e8; border: 2px solid #27ae60; border-radius: 8px; padding: 15px; margin: 10px 0; color: #2c3e50;">
                    <h4 style="margin: 0 0 10px 0; color: #27ae60;">
                        <i class="fas fa-user-check"></i> Paciente da Gest√£o
                    </h4>
                    <p style="margin: 5px 0;"><strong>Nome:</strong> ${dadosPaciente.nome}</p>
                    <p style="margin: 5px 0;"><strong>ID:</strong> ${dadosPaciente.id}</p>
                    <p style="margin: 5px 0;"><strong>Status Geral:</strong> ${dadosPaciente.statusGeral}</p>
                    ${dadosPaciente.dataUltimaConsulta ? `<p style="margin: 5px 0;"><strong>√öltima Consulta:</strong> ${formatarDataBrasil(dadosPaciente.dataUltimaConsulta)}</p>` : ''}
                    ${dadosPaciente.observacoes ? `<p style="margin: 5px 0;"><strong>Observa√ß√µes:</strong> ${dadosPaciente.observacoes}</p>` : ''}
                </div>
            `;
            
            // Inserir ap√≥s o header
            const container = document.querySelector('.container');
            const header = container.querySelector('.header');
            container.insertBefore(infoDiv, header.nextSibling);
        }
        
        // Fun√ß√£o auxiliar para formatar data
        function formatarDataBrasil(dataISO) {
            if (!dataISO) return '';
            const data = new Date(dataISO);
            return data.toLocaleDateString('pt-BR');
        }
    </script>
</body>
</html>
