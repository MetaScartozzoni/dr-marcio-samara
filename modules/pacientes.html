<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal do Paciente - Dr. Marcio Scartozzoni</title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .patient-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .patient-welcome {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .patient-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2em;
            border: 3px solid rgba(255,255,255,0.3);
        }

        .patient-info h1 {
            margin: 0;
            font-size: 1.8em;
            font-weight: 700;
        }

        .patient-info p {
            margin: 5px 0 0 0;
            opacity: 0.9;
        }

        .notifications-bell {
            position: relative;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 12px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s ease;
        }

        .notifications-bell:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4757;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7em;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .patient-dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .dash-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .dash-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .dash-card.consulta { border-left: 4px solid #667eea; }
        .dash-card.documentos { border-left: 4px solid #28a745; }
        .dash-card.chat { border-left: 4px solid #17a2b8; }
        .dash-card.avaliacao { border-left: 4px solid #ffc107; }

        .dash-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
            opacity: 0.8;
        }

        .dash-card.consulta .dash-icon { color: #667eea; }
        .dash-card.documentos .dash-icon { color: #28a745; }
        .dash-card.chat .dash-icon { color: #17a2b8; }
        .dash-card.avaliacao .dash-icon { color: #ffc107; }

        .dash-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 5px;
            color: #2c3e50;
        }

        .dash-subtitle {
            font-size: 0.9em;
            color: #6c757d;
        }

        .main-sections {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }

        .section-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .section-header {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            justify-content: between;
        }

        .section-header h3 {
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #2c3e50;
        }

        .section-content {
            padding: 20px;
        }

        .agendamento-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
        }

        .agendamento-item:hover {
            background: #e3f2fd;
            transform: translateX(5px);
        }

        .agendamento-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .agendamento-data {
            font-weight: 600;
            color: #667eea;
        }

        .agendamento-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-confirmado { background: #d4edda; color: #155724; }
        .status-pendente { background: #fff3cd; color: #856404; }
        .status-cancelado { background: #f8d7da; color: #721c24; }

        .agendamento-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 0.9em;
            color: #6c757d;
        }

        .document-upload {
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .document-upload:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .document-upload.dragover {
            border-color: #667eea;
            background: #e3f2fd;
        }

        .upload-icon {
            font-size: 2.5em;
            color: #667eea;
            margin-bottom: 15px;
        }

        .document-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .document-item:hover {
            background: #e9ecef;
        }

        .document-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .document-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            color: white;
        }

        .doc-pdf { background: #dc3545; }
        .doc-image { background: #28a745; }
        .doc-word { background: #007bff; }

        .document-details h5 {
            margin: 0;
            font-size: 0.9em;
            color: #2c3e50;
        }

        .document-details p {
            margin: 2px 0 0 0;
            font-size: 0.8em;
            color: #6c757d;
        }

        .document-actions {
            display: flex;
            gap: 8px;
        }

        .btn-doc {
            background: none;
            border: 1px solid #dee2e6;
            color: #6c757d;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8em;
        }

        .btn-doc:hover {
            background: #f8f9fa;
            color: #495057;
        }

        .chat-container {
            height: 400px;
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #f8f9fa;
            max-height: 300px;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-end;
            gap: 10px;
        }

        .message.sent {
            flex-direction: row-reverse;
        }

        .message-bubble {
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 18px;
            position: relative;
        }

        .message.sent .message-bubble {
            background: #667eea;
            color: white;
        }

        .message.received .message-bubble {
            background: white;
            color: #2c3e50;
            border: 1px solid #e9ecef;
        }

        .message-time {
            font-size: 0.7em;
            opacity: 0.7;
            margin-top: 5px;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #667eea;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8em;
        }

        .chat-input {
            display: flex;
            padding: 15px;
            background: white;
            border-top: 1px solid #e9ecef;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #dee2e6;
            border-radius: 25px;
            outline: none;
        }

        .chat-input input:focus {
            border-color: #667eea;
        }

        .btn-send {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-send:hover {
            background: #5a6fd8;
            transform: scale(1.1);
        }

        .reminder-item {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            position: relative;
        }

        .reminder-item.urgent {
            background: #f8d7da;
            border-color: #f5c6cb;
        }

        .reminder-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .reminder-title {
            font-weight: 600;
            color: #856404;
        }

        .reminder-item.urgent .reminder-title {
            color: #721c24;
        }

        .reminder-time {
            font-size: 0.8em;
            color: #6c757d;
        }

        .evaluation-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .rating-stars {
            display: flex;
            gap: 5px;
            margin: 10px 0;
            justify-content: center;
        }

        .star {
            font-size: 1.5em;
            color: #dee2e6;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .star:hover,
        .star.active {
            color: #ffc107;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .quick-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.9em;
        }

        .quick-btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .modal-header h3 {
            margin: 0;
            color: #2c3e50;
        }

        .btn-close {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #6c757d;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-primary {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: #5a6fd8;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            margin-right: 10px;
        }

        @media (max-width: 1200px) {
            .patient-dashboard {
                grid-template-columns: 1fr 1fr;
            }
            
            .main-sections {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .patient-header {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }
            
            .patient-dashboard {
                grid-template-columns: 1fr;
            }
            
            .agendamento-details {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <script src="../assets/js/security-dev.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header do Paciente -->
        <div class="patient-header">
            <div class="patient-welcome">
                <div class="patient-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="patient-info">
                    <h1>Ol√°, Maria Silva!</h1>
                    <p>Bem-vinda ao seu portal pessoal</p>
                    <p><i class="fas fa-calendar"></i> Pr√≥xima consulta: 15/08/2024 √†s 14:30</p>
                </div>
            </div>
            <div style="display: flex; align-items: center; gap: 15px;">
                <a href="../index.html" style="background: rgba(255,255,255,0.2); color: white; text-decoration: none; padding: 10px 15px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); transition: all 0.3s ease; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-arrow-left"></i> Portal Principal
                </a>
                <div class="notifications-bell" onclick="abrirNotificacoes()">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge">3</span>
                </div>
            </div>
        </div>

        <!-- Dashboard Cards -->
        <div class="patient-dashboard">
            <div class="dash-card consulta" onclick="abrirConsultas()">
                <div class="dash-icon">
                    <i class="fas fa-calendar-check"></i>
                </div>
                <div class="dash-title">Consultas</div>
                <div class="dash-subtitle">2 agendadas</div>
            </div>
            
            <div class="dash-card documentos" onclick="abrirDocumentos()">
                <div class="dash-icon">
                    <i class="fas fa-file-medical"></i>
                </div>
                <div class="dash-title">Documentos</div>
                <div class="dash-subtitle">5 arquivos</div>
            </div>
            
            <div class="dash-card chat" onclick="abrirChat()">
                <div class="dash-icon">
                    <i class="fas fa-comments"></i>
                </div>
                <div class="dash-title">Chat</div>
                <div class="dash-subtitle">2 n√£o lidas</div>
            </div>
            
            <div class="dash-card avaliacao" onclick="abrirAvaliacoes()">
                <div class="dash-icon">
                    <i class="fas fa-star"></i>
                </div>
                <div class="dash-title">Avalia√ß√µes</div>
                <div class="dash-subtitle">1 pendente</div>
            </div>
        </div>

        <!-- Se√ß√µes Principais -->
        <div class="main-sections">
            <!-- Se√ß√£o Principal -->
            <div>
                <!-- Pr√≥ximas Consultas -->
                <div class="section-card" id="secao-consultas">
                    <div class="section-header">
                        <h3><i class="fas fa-calendar-alt"></i> Pr√≥ximas Consultas</h3>
                        <button class="btn-primary" onclick="agendarConsulta()">
                            <i class="fas fa-plus"></i> Agendar
                        </button>
                    </div>
                    <div class="section-content">
                        <div class="agendamento-item">
                            <div class="agendamento-header">
                                <div class="agendamento-data">15 de Agosto, 2024 - 14:30</div>
                                <span class="agendamento-status status-confirmado">Confirmado</span>
                            </div>
                            <div class="agendamento-details">
                                <div><i class="fas fa-user-md"></i> Dr. Marcio Scartozzoni</div>
                                <div><i class="fas fa-map-marker-alt"></i> Consult√≥rio Principal</div>
                                <div><i class="fas fa-clock"></i> 60 minutos</div>
                                <div><i class="fas fa-notes-medical"></i> Consulta de Retorno</div>
                            </div>
                        </div>
                        
                        <div class="agendamento-item">
                            <div class="agendamento-header">
                                <div class="agendamento-data">22 de Agosto, 2024 - 10:00</div>
                                <span class="agendamento-status status-pendente">Aguardando</span>
                            </div>
                            <div class="agendamento-details">
                                <div><i class="fas fa-user-md"></i> Dr. Marcio Scartozzoni</div>
                                <div><i class="fas fa-map-marker-alt"></i> Centro Cir√∫rgico</div>
                                <div><i class="fas fa-clock"></i> 180 minutos</div>
                                <div><i class="fas fa-cut"></i> Procedimento Cir√∫rgico</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gest√£o de Documentos -->
                <div class="section-card" id="secao-documentos" style="display: none;">
                    <div class="section-header">
                        <h3><i class="fas fa-folder-open"></i> Meus Documentos</h3>
                    </div>
                    <div class="section-content">
                        <div class="document-upload" onclick="selecionarArquivo()" ondrop="dropHandler(event)" ondragover="dragOverHandler(event)">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <h4>Arraste arquivos aqui ou clique para selecionar</h4>
                            <p>Exames, receitas, comprovantes - PDF, JPG, PNG (m√°x. 10MB)</p>
                        </div>

                        <div id="documentos-lista">
                            <div class="document-item">
                                <div class="document-info">
                                    <div class="document-icon doc-pdf">
                                        <i class="fas fa-file-pdf"></i>
                                    </div>
                                    <div class="document-details">
                                        <h5>Exame de Sangue - Julho 2024</h5>
                                        <p>245 KB ‚Ä¢ Enviado em 05/08/2024</p>
                                    </div>
                                </div>
                                <div class="document-actions">
                                    <button class="btn-doc" onclick="visualizarDocumento('doc1')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn-doc" onclick="baixarDocumento('doc1')">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="btn-doc" onclick="excluirDocumento('doc1')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="document-item">
                                <div class="document-info">
                                    <div class="document-icon doc-image">
                                        <i class="fas fa-file-image"></i>
                                    </div>
                                    <div class="document-details">
                                        <h5>Foto Pr√©-Operat√≥rio</h5>
                                        <p>1.2 MB ‚Ä¢ Enviado em 02/08/2024</p>
                                    </div>
                                </div>
                                <div class="document-actions">
                                    <button class="btn-doc" onclick="visualizarDocumento('doc2')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn-doc" onclick="baixarDocumento('doc2')">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="btn-doc" onclick="excluirDocumento('doc2')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="document-item">
                                <div class="document-info">
                                    <div class="document-icon doc-word">
                                        <i class="fas fa-file-word"></i>
                                    </div>
                                    <div class="document-details">
                                        <h5>Termo de Consentimento</h5>
                                        <p>89 KB ‚Ä¢ Enviado em 01/08/2024</p>
                                    </div>
                                </div>
                                <div class="document-actions">
                                    <button class="btn-doc" onclick="visualizarDocumento('doc3')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn-doc" onclick="baixarDocumento('doc3')">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="btn-doc" onclick="excluirDocumento('doc3')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat com a Cl√≠nica -->
                <div class="section-card" id="secao-chat" style="display: none;">
                    <div class="section-header">
                        <h3><i class="fas fa-comments"></i> Chat com a Cl√≠nica</h3>
                        <span style="font-size: 0.9em; color: #28a745;">
                            <i class="fas fa-circle" style="font-size: 0.7em;"></i> Online
                        </span>
                    </div>
                    <div class="section-content" style="padding: 0;">
                        <div class="chat-container">
                            <div class="chat-messages" id="chat-messages">
                                <div class="message received">
                                    <div class="message-avatar">
                                        <i class="fas fa-user-md"></i>
                                    </div>
                                    <div>
                                        <div class="message-bubble">
                                            Ol√° Maria! Como voc√™ est√° se sentindo ap√≥s a consulta de ontem?
                                        </div>
                                        <div class="message-time">Hoje, 09:15</div>
                                    </div>
                                </div>

                                <div class="message sent">
                                    <div>
                                        <div class="message-bubble">
                                            Ol√°! Estou me sentindo bem, obrigada. Apenas uma pequena sensibilidade na regi√£o, mas nada preocupante.
                                        </div>
                                        <div class="message-time">Hoje, 09:20</div>
                                    </div>
                                    <div class="message-avatar">M</div>
                                </div>

                                <div class="message received">
                                    <div class="message-avatar">
                                        <i class="fas fa-user-md"></i>
                                    </div>
                                    <div>
                                        <div class="message-bubble">
                                            Perfeito! Isso √© normal nos primeiros dias. Continue com os cuidados que orientamos. Alguma d√∫vida sobre o p√≥s-operat√≥rio?
                                        </div>
                                        <div class="message-time">Hoje, 09:25</div>
                                    </div>
                                </div>

                                <div class="message sent">
                                    <div>
                                        <div class="message-bubble">
                                            Tenho uma d√∫vida sobre quando posso retomar exerc√≠cios f√≠sicos.
                                        </div>
                                        <div class="message-time">Hoje, 14:30</div>
                                    </div>
                                    <div class="message-avatar">M</div>
                                </div>
                            </div>
                            <div class="chat-input">
                                <input type="text" id="mensagem-input" placeholder="Digite sua mensagem..." onkeypress="enviarPorEnter(event)">
                                <button class="btn-send" onclick="enviarMensagem()">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Avalia√ß√µes -->
                <div class="section-card" id="secao-avaliacoes" style="display: none;">
                    <div class="section-header">
                        <h3><i class="fas fa-star"></i> Avalia√ß√µes P√≥s-Consulta</h3>
                    </div>
                    <div class="section-content">
                        <div class="evaluation-form">
                            <h4>Avalie sua √∫ltima consulta</h4>
                            <p>Consulta do dia 10/08/2024 - Dr. Marcio Scartozzoni</p>
                            
                            <div style="margin: 20px 0;">
                                <label><strong>Qualidade do atendimento:</strong></label>
                                <div class="rating-stars" data-rating="atendimento">
                                    <span class="star" data-value="1">‚òÖ</span>
                                    <span class="star" data-value="2">‚òÖ</span>
                                    <span class="star" data-value="3">‚òÖ</span>
                                    <span class="star" data-value="4">‚òÖ</span>
                                    <span class="star" data-value="5">‚òÖ</span>
                                </div>
                            </div>

                            <div style="margin: 20px 0;">
                                <label><strong>Clareza das explica√ß√µes:</strong></label>
                                <div class="rating-stars" data-rating="clareza">
                                    <span class="star" data-value="1">‚òÖ</span>
                                    <span class="star" data-value="2">‚òÖ</span>
                                    <span class="star" data-value="3">‚òÖ</span>
                                    <span class="star" data-value="4">‚òÖ</span>
                                    <span class="star" data-value="5">‚òÖ</span>
                                </div>
                            </div>

                            <div style="margin: 20px 0;">
                                <label><strong>Pontualidade:</strong></label>
                                <div class="rating-stars" data-rating="pontualidade">
                                    <span class="star" data-value="1">‚òÖ</span>
                                    <span class="star" data-value="2">‚òÖ</span>
                                    <span class="star" data-value="3">‚òÖ</span>
                                    <span class="star" data-value="4">‚òÖ</span>
                                    <span class="star" data-value="5">‚òÖ</span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Coment√°rios (opcional):</label>
                                <textarea id="comentarios-avaliacao" rows="4" placeholder="Compartilhe sua experi√™ncia..."></textarea>
                            </div>

                            <button class="btn-primary" onclick="enviarAvaliacao()">
                                <i class="fas fa-paper-plane"></i> Enviar Avalia√ß√£o
                            </button>
                        </div>

                        <div style="margin-top: 30px;">
                            <h4>Hist√≥rico de Avalia√ß√µes</h4>
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 10px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <strong>Consulta - 25/07/2024</strong>
                                    <span style="color: #ffc107;">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                                </div>
                                <p style="margin: 0; color: #6c757d; font-size: 0.9em;">
                                    "Excelente atendimento! Dr. Marcio foi muito atencioso e esclareceu todas as minhas d√∫vidas."
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div>
                <!-- Lembretes Push -->
                <div class="section-card">
                    <div class="section-header">
                        <h3><i class="fas fa-bell"></i> Lembretes</h3>
                    </div>
                    <div class="section-content">
                        <div class="reminder-item urgent">
                            <div class="reminder-header">
                                <div class="reminder-title">Medica√ß√£o</div>
                                <div class="reminder-time">15:00</div>
                            </div>
                            <p>Tomar antibi√≥tico - Amoxicilina 500mg</p>
                        </div>

                        <div class="reminder-item">
                            <div class="reminder-header">
                                <div class="reminder-title">Consulta Amanh√£</div>
                                <div class="reminder-time">14:30</div>
                            </div>
                            <p>Consulta de retorno com Dr. Marcio</p>
                        </div>

                        <div class="reminder-item">
                            <div class="reminder-header">
                                <div class="reminder-title">Exame</div>
                                <div class="reminder-time">20/08</div>
                            </div>
                            <p>Agendar ultrassom de controle</p>
                        </div>
                    </div>
                </div>

                <!-- A√ß√µes R√°pidas -->
                <div class="section-card">
                    <div class="section-header">
                        <h3><i class="fas fa-bolt"></i> A√ß√µes R√°pidas</h3>
                    </div>
                    <div class="section-content">
                        <div class="quick-actions">
                            <button class="quick-btn" onclick="agendarConsulta()">
                                <i class="fas fa-calendar-plus"></i>
                                Agendar
                            </button>
                            <button class="quick-btn" onclick="cancelarConsulta()">
                                <i class="fas fa-calendar-times"></i>
                                Cancelar
                            </button>
                            <button class="quick-btn" onclick="solicitarReceita()">
                                <i class="fas fa-prescription"></i>
                                Receita
                            </button>
                            <button class="quick-btn" onclick="emergencia()">
                                <i class="fas fa-exclamation-triangle"></i>
                                Emerg√™ncia
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Informa√ß√µes de Contato -->
                <div class="section-card">
                    <div class="section-header">
                        <h3><i class="fas fa-phone"></i> Contato</h3>
                    </div>
                    <div class="section-content">
                        <div style="margin-bottom: 15px;">
                            <strong>üìû Telefone:</strong><br>
                            (11) 99999-9999
                        </div>
                        <div style="margin-bottom: 15px;">
                            <strong>üìß E-mail:</strong><br>
                            contato@drmarcioscartozzoni.com
                        </div>
                        <div style="margin-bottom: 15px;">
                            <strong>üìç Endere√ßo:</strong><br>
                            Rua das Flores, 123<br>
                            S√£o Paulo - SP
                        </div>
                        <div>
                            <strong>üïê Hor√°rio:</strong><br>
                            Seg-Sex: 8h √†s 18h<br>
                            S√°b: 8h √†s 12h
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Agendar Consulta -->
    <div class="modal" id="modalAgendarConsulta">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-calendar-plus"></i> Agendar Nova Consulta</h3>
                <button class="btn-close" onclick="fecharModal('modalAgendarConsulta')">&times;</button>
            </div>
            <div>
                <div class="form-group">
                    <label>Tipo de Consulta:</label>
                    <select id="tipo-consulta">
                        <option value="consulta">Consulta Regular</option>
                        <option value="retorno">Retorno</option>
                        <option value="procedimento">Procedimento</option>
                        <option value="emergencia">Emerg√™ncia</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Data Preferida:</label>
                    <input type="date" id="data-consulta" min="">
                </div>
                
                <div class="form-group">
                    <label>Hor√°rio Preferido:</label>
                    <select id="horario-consulta">
                        <option value="09:00">09:00</option>
                        <option value="10:00">10:00</option>
                        <option value="11:00">11:00</option>
                        <option value="14:00">14:00</option>
                        <option value="15:00">15:00</option>
                        <option value="16:00">16:00</option>
                        <option value="17:00">17:00</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Observa√ß√µes:</label>
                    <textarea id="observacoes-consulta" rows="3" placeholder="Descreva o motivo da consulta ou observa√ß√µes especiais..."></textarea>
                </div>
                
                <div style="display: flex; justify-content: flex-end; gap: 10px;">
                    <button class="btn-secondary" onclick="fecharModal('modalAgendarConsulta')">Cancelar</button>
                    <button class="btn-primary" onclick="confirmarAgendamento()">
                        <i class="fas fa-check"></i> Confirmar Agendamento
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Input oculto para upload de arquivos -->
    <input type="file" id="file-input" style="display: none;" multiple accept=".pdf,.jpg,.jpeg,.png,.doc,.docx" onchange="processarArquivos(this.files)">

    <script>
        let avaliacoes = {
            atendimento: 0,
            clareza: 0,
            pontualidade: 0
        };

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üë®‚Äç‚öïÔ∏è Portal do Paciente - Inicializando...');
            
            // Configurar data m√≠nima para agendamento
            const hoje = new Date();
            hoje.setDate(hoje.getDate() + 1); // Amanh√£ no m√≠nimo
            document.getElementById('data-consulta').min = hoje.toISOString().split('T')[0];
            
            // Inicializar sistema de rating
            inicializarRating();
            
            // Solicitar permiss√£o para notifica√ß√µes push
            solicitarPermissaoNotificacao();
            
            console.log('‚úÖ Portal do Paciente carregado com sucesso!');
        });

        // Navega√ß√£o entre se√ß√µes
        function abrirConsultas() {
            mostrarSecao('secao-consultas');
        }

        function abrirDocumentos() {
            mostrarSecao('secao-documentos');
        }

        function abrirChat() {
            mostrarSecao('secao-chat');
            // Scroll para o final das mensagens
            const messages = document.getElementById('chat-messages');
            messages.scrollTop = messages.scrollHeight;
        }

        function abrirAvaliacoes() {
            mostrarSecao('secao-avaliacoes');
        }

        function mostrarSecao(secaoId) {
            // Ocultar todas as se√ß√µes
            const secoes = ['secao-consultas', 'secao-documentos', 'secao-chat', 'secao-avaliacoes'];
            secoes.forEach(id => {
                document.getElementById(id).style.display = 'none';
            });
            
            // Mostrar se√ß√£o selecionada
            document.getElementById(secaoId).style.display = 'block';
        }

        // Sistema de Agendamento
        function agendarConsulta() {
            document.getElementById('modalAgendarConsulta').classList.add('active');
        }

        function fecharModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function confirmarAgendamento() {
            const tipo = document.getElementById('tipo-consulta').value;
            const data = document.getElementById('data-consulta').value;
            const horario = document.getElementById('horario-consulta').value;
            const observacoes = document.getElementById('observacoes-consulta').value;

            if (!data) {
                SecureNotification.error('Por favor, selecione uma data para a consulta.');
                return;
            }

            const novaConsulta = {
                tipo: tipo,
                data: data,
                horario: horario,
                observacoes: observacoes,
                status: 'pendente'
            };

            // Simular agendamento
            SecureNotification.show('üìÖ Processando seu agendamento...');
            
            setTimeout(() => {
                SecureNotification.success('‚úÖ Solicita√ß√£o de agendamento enviada!\n\nVoc√™ receber√° uma confirma√ß√£o em breve via WhatsApp e e-mail.');
                fecharModal('modalAgendarConsulta');
                
                // Limpar formul√°rio
                document.getElementById('tipo-consulta').value = 'consulta';
                document.getElementById('data-consulta').value = '';
                document.getElementById('observacoes-consulta').value = '';
                
                // Log de auditoria
                AuditSystem.log('AGENDAMENTO_SOLICITADO', novaConsulta);
                
                // Simular notifica√ß√£o push
                setTimeout(() => {
                    mostrarNotificacaoPush('‚úÖ Agendamento Confirmado', 'Sua consulta foi confirmada para ' + formatarData(data) + ' √†s ' + horario);
                }, 3000);
                
            }, 2000);
        }

        function cancelarConsulta() {
            if (confirm('‚ùå Tem certeza que deseja cancelar uma consulta?\n\nEsta a√ß√£o enviar√° uma solicita√ß√£o de cancelamento para a cl√≠nica.')) {
                SecureNotification.show('üìû Enviando solicita√ß√£o de cancelamento...');
                
                setTimeout(() => {
                    SecureNotification.success('‚úÖ Solicita√ß√£o de cancelamento enviada!\n\nA cl√≠nica entrar√° em contato para confirmar o cancelamento.');
                    AuditSystem.log('CANCELAMENTO_SOLICITADO');
                }, 1500);
            }
        }

        // Sistema de Upload de Documentos
        function selecionarArquivo() {
            document.getElementById('file-input').click();
        }

        function dragOverHandler(ev) {
            ev.preventDefault();
            ev.currentTarget.classList.add('dragover');
        }

        function dropHandler(ev) {
            ev.preventDefault();
            ev.currentTarget.classList.remove('dragover');
            
            const files = ev.dataTransfer.files;
            processarArquivos(files);
        }

        function processarArquivos(files) {
            if (files.length === 0) return;

            SecureNotification.show(`üìÅ Enviando ${files.length} arquivo(s)...`);

            // Simular upload
            setTimeout(() => {
                const lista = document.getElementById('documentos-lista');
                
                Array.from(files).forEach(file => {
                    const tipoIcon = file.type.includes('pdf') ? 'doc-pdf' : 
                                   file.type.includes('image') ? 'doc-image' : 'doc-word';
                    const icon = file.type.includes('pdf') ? 'file-pdf' : 
                               file.type.includes('image') ? 'file-image' : 'file-word';
                    
                    const novoItem = document.createElement('div');
                    novoItem.className = 'document-item';
                    novoItem.innerHTML = `
                        <div class="document-info">
                            <div class="document-icon ${tipoIcon}">
                                <i class="fas fa-${icon}"></i>
                            </div>
                            <div class="document-details">
                                <h5>${file.name}</h5>
                                <p>${formatarTamanho(file.size)} ‚Ä¢ Enviado hoje</p>
                            </div>
                        </div>
                        <div class="document-actions">
                            <button class="btn-doc" onclick="visualizarDocumento('new${Date.now()}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-doc" onclick="baixarDocumento('new${Date.now()}')">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="btn-doc" onclick="excluirDocumento('new${Date.now()}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    
                    lista.insertBefore(novoItem, lista.firstChild);
                });
                
                SecureNotification.success(`‚úÖ ${files.length} arquivo(s) enviado(s) com sucesso!`);
                AuditSystem.log('DOCUMENTOS_UPLOADED', {quantidade: files.length});
                
                // Atualizar contador no dashboard
                const contadorDocs = document.querySelector('.dash-card.documentos .dash-subtitle');
                const total = lista.children.length;
                contadorDocs.textContent = `${total} arquivos`;
                
            }, 2000);
        }

        function formatarTamanho(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function visualizarDocumento(id) {
            SecureNotification.show('üëÅÔ∏è Abrindo documento...');
            setTimeout(() => {
                SecureNotification.success('üìÑ Em ambiente de produ√ß√£o, o documento seria aberto em uma nova aba.');
            }, 1000);
        }

        function baixarDocumento(id) {
            SecureNotification.show('üì• Iniciando download...');
            setTimeout(() => {
                SecureNotification.success('‚úÖ Em ambiente de produ√ß√£o, o arquivo seria baixado automaticamente.');
            }, 1000);
        }

        function excluirDocumento(id) {
            if (confirm('‚ùå Tem certeza que deseja excluir este documento?\n\nEsta a√ß√£o n√£o pode ser desfeita.')) {
                SecureNotification.success('üóëÔ∏è Documento exclu√≠do com sucesso!');
                // Em implementa√ß√£o real, removeria o elemento do DOM
            }
        }

        // Sistema de Chat
        function enviarMensagem() {
            const input = document.getElementById('mensagem-input');
            const mensagem = input.value.trim();
            
            if (!mensagem) return;
            
            const chatMessages = document.getElementById('chat-messages');
            const agora = new Date();
            
            // Adicionar mensagem do paciente
            const novaMensagem = document.createElement('div');
            novaMensagem.className = 'message sent';
            novaMensagem.innerHTML = `
                <div>
                    <div class="message-bubble">${mensagem}</div>
                    <div class="message-time">Hoje, ${agora.toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'})}</div>
                </div>
                <div class="message-avatar">M</div>
            `;
            
            chatMessages.appendChild(novaMensagem);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Limpar input
            input.value = '';
            
            // Simular resposta autom√°tica
            setTimeout(() => {
                const respostaAuto = document.createElement('div');
                respostaAuto.className = 'message received';
                respostaAuto.innerHTML = `
                    <div class="message-avatar">
                        <i class="fas fa-user-md"></i>
                    </div>
                    <div>
                        <div class="message-bubble">Recebemos sua mensagem! Nossa equipe responder√° em breve. Para emerg√™ncias, ligue (11) 99999-9999.</div>
                        <div class="message-time">Hoje, ${new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'})}</div>
                    </div>
                `;
                
                chatMessages.appendChild(respostaAuto);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Mostrar notifica√ß√£o de nova mensagem
                mostrarNotificacaoPush('üí¨ Nova Mensagem', 'A cl√≠nica respondeu sua mensagem');
                
            }, 3000);
            
            AuditSystem.log('MENSAGEM_ENVIADA', {conteudo: mensagem.substring(0, 50)});
        }

        function enviarPorEnter(event) {
            if (event.key === 'Enter') {
                enviarMensagem();
            }
        }

        // Sistema de Avalia√ß√µes
        function inicializarRating() {
            document.querySelectorAll('.rating-stars').forEach(ratingContainer => {
                const stars = ratingContainer.querySelectorAll('.star');
                const ratingType = ratingContainer.dataset.rating;
                
                stars.forEach((star, index) => {
                    star.addEventListener('click', () => {
                        const rating = index + 1;
                        avaliacoes[ratingType] = rating;
                        
                        // Atualizar visualiza√ß√£o
                        stars.forEach((s, i) => {
                            if (i < rating) {
                                s.classList.add('active');
                            } else {
                                s.classList.remove('active');
                            }
                        });
                    });
                    
                    star.addEventListener('mouseover', () => {
                        stars.forEach((s, i) => {
                            if (i <= index) {
                                s.style.color = '#ffc107';
                            } else {
                                s.style.color = '#dee2e6';
                            }
                        });
                    });
                });
                
                ratingContainer.addEventListener('mouseleave', () => {
                    const currentRating = avaliacoes[ratingType];
                    stars.forEach((s, i) => {
                        if (i < currentRating) {
                            s.style.color = '#ffc107';
                        } else {
                            s.style.color = '#dee2e6';
                        }
                    });
                });
            });
        }

        function enviarAvaliacao() {
            const { atendimento, clareza, pontualidade } = avaliacoes;
            const comentarios = document.getElementById('comentarios-avaliacao').value;
            
            if (atendimento === 0 || clareza === 0 || pontualidade === 0) {
                SecureNotification.error('Por favor, avalie todos os itens com as estrelas.');
                return;
            }
            
            const avaliacao = {
                atendimento,
                clareza,
                pontualidade,
                comentarios,
                data: new Date().toISOString().split('T')[0]
            };
            
            SecureNotification.show('‚≠ê Enviando sua avalia√ß√£o...');
            
            setTimeout(() => {
                SecureNotification.success('‚úÖ Avalia√ß√£o enviada com sucesso!\n\nObrigado pelo seu feedback. Ele nos ajuda a melhorar nossos servi√ßos.');
                
                // Limpar formul√°rio
                avaliacoes = { atendimento: 0, clareza: 0, pontualidade: 0 };
                document.getElementById('comentarios-avaliacao').value = '';
                document.querySelectorAll('.star').forEach(star => {
                    star.classList.remove('active');
                    star.style.color = '#dee2e6';
                });
                
                AuditSystem.log('AVALIACAO_ENVIADA', avaliacao);
                
                // Atualizar contador no dashboard
                const contadorAval = document.querySelector('.dash-card.avaliacao .dash-subtitle');
                contadorAval.textContent = 'Nenhuma pendente';
                
            }, 2000);
        }

        // A√ß√µes R√°pidas
        function solicitarReceita() {
            if (confirm('üíä SOLICITAR RECEITA\n\nDeseja solicitar uma nova receita m√©dica?\n\nA solicita√ß√£o ser√° enviada para an√°lise do Dr. Marcio.')) {
                SecureNotification.show('üìã Enviando solicita√ß√£o...');
                
                setTimeout(() => {
                    SecureNotification.success('‚úÖ Solicita√ß√£o de receita enviada!\n\nVoc√™ receber√° a receita por e-mail em at√© 24 horas.');
                    AuditSystem.log('RECEITA_SOLICITADA');
                }, 1500);
            }
        }

        function emergencia() {
            if (confirm('üö® EMERG√äNCIA M√âDICA\n\nEsta op√ß√£o √© para situa√ß√µes de emerg√™ncia.\n\nPara emerg√™ncias graves, ligue para o SAMU (192).\n\nDeseja entrar em contato direto com a cl√≠nica?')) {
                SecureNotification.show('üö® Conectando com emerg√™ncia...');
                
                setTimeout(() => {
                    SecureNotification.success('üìû Clique para ligar:\n(11) 99999-9999\n\nOu aguarde - a cl√≠nica ligar√° para voc√™ em instantes.');
                    AuditSystem.log('EMERGENCIA_ACIONADA');
                    
                    // Simular chamada de emerg√™ncia
                    setTimeout(() => {
                        mostrarNotificacaoPush('üö® Emerg√™ncia', 'A cl√≠nica tentar√° contato em instantes');
                    }, 2000);
                }, 1000);
            }
        }

        // Sistema de Notifica√ß√µes Push
        function solicitarPermissaoNotificacao() {
            if ('Notification' in window) {
                if (Notification.permission === 'default') {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            console.log('‚úÖ Permiss√£o para notifica√ß√µes concedida');
                            mostrarNotificacaoPush('üîî Notifica√ß√µes Ativas', 'Voc√™ receber√° lembretes importantes');
                        }
                    });
                }
            }
        }

        function mostrarNotificacaoPush(titulo, mensagem) {
            if ('Notification' in window && Notification.permission === 'granted') {
                const notification = new Notification(titulo, {
                    body: mensagem,
                    icon: '../assets/images/logo-notification.png', // Em produ√ß√£o, usar √≠cone real
                    badge: '../assets/images/badge.png',
                    tag: 'portal-paciente',
                    requireInteraction: true
                });
                
                notification.onclick = function() {
                    window.focus();
                    notification.close();
                };
                
                // Auto-fechar ap√≥s 5 segundos
                setTimeout(() => {
                    notification.close();
                }, 5000);
            } else {
                // Fallback - mostrar notifica√ß√£o no sistema
                SecureNotification.show(`üîî ${titulo}\n${mensagem}`);
            }
        }

        function abrirNotificacoes() {
            const notificacoes = [
                'Lembrete: Medica√ß√£o √†s 15:00',
                'Nova mensagem da cl√≠nica',
                'Consulta confirmada para amanh√£'
            ];
            
            SecureNotification.show(`üîî NOTIFICA√á√ïES (${notificacoes.length})\n\n` + notificacoes.join('\n'));
        }

        // Utilit√°rios
        function formatarData(data) {
            return new Date(data).toLocaleDateString('pt-BR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        // Simula√ß√£o de lembretes autom√°ticos
        setTimeout(() => {
            mostrarNotificacaoPush('üíä Lembrete de Medica√ß√£o', 'Hora de tomar seu antibi√≥tico - Amoxicilina 500mg');
        }, 10000); // 10 segundos ap√≥s carregar

        // Simula√ß√£o de nova mensagem no chat
        setTimeout(() => {
            mostrarNotificacaoPush('üí¨ Nova Mensagem', 'A cl√≠nica respondeu sua pergunta sobre exerc√≠cios');
        }, 30000); // 30 segundos ap√≥s carregar
    </script>
</body>
</html>
