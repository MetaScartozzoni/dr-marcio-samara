<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciar Usu√°rios - Portal Dr. Marcio</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .section {
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }
        .section h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="form-container">
            <h1>Gerenciar Usu√°rios</h1>
            <p>Atualize roles e autoriza√ß√µes dos usu√°rios</p>
            
            <!-- Se√ß√£o: Atualizar Role -->
            <div class="section">
                <h2>üîß Atualizar Tipo de Usu√°rio (Role)</h2>
                <form id="updateRoleForm">
                    <div class="input-group">
                        <label for="email">Email do Usu√°rio:</label>
                        <input type="email" id="email" name="email" required placeholder="Digite o email do usu√°rio">
                    </div>
                    
                    <div class="input-group">
                        <label for="novoRole">Novo Tipo de Usu√°rio:</label>
                        <select id="novoRole" name="novoRole" required>
                            <option value="">Selecione o novo role</option>
                            <option value="patient">Paciente</option>
                            <option value="staff">Funcion√°rio</option>
                            <option value="admin">Administrador</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn-primary">Atualizar Role</button>
                </form>
            </div>

            <!-- Se√ß√£o: Atualizar Autoriza√ß√£o -->
            <div class="section" style="margin-top: 40px;">
                <h2>‚úÖ Autorizar/Desautorizar Usu√°rio</h2>
                <form id="updateAuthForm">
                    <div class="input-group">
                        <label for="emailAuth">Email do Usu√°rio:</label>
                        <input type="email" id="emailAuth" name="emailAuth" required placeholder="Digite o email do usu√°rio">
                    </div>
                    
                    <div class="input-group">
                        <label for="autorizado">Status de Autoriza√ß√£o:</label>
                        <select id="autorizado" name="autorizado" required>
                            <option value="">Selecione o status</option>
                            <option value="sim">‚úÖ Autorizado</option>
                            <option value="nao">‚ùå N√£o Autorizado</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn-primary">Atualizar Autoriza√ß√£o</button>
                </form>
            </div>
            
            <div id="loading" class="loading" style="display: none;">
                Processando...
            </div>
            
            <div id="message" class="message"></div>
            
            <div class="info-section" style="margin-top: 30px; padding: 20px; background: #f5f5f5; border-radius: 8px;">
                <h3>Exemplos de uso:</h3>
                <ul>
                    <li><strong>Roles:</strong> administracao@mscartozzoni.com.br ‚Üí Administrador</li>
                    <li><strong>Autoriza√ß√£o:</strong> Novos usu√°rios come√ßam como "N√£o Autorizado"</li>
                    <li><strong>Fluxo:</strong> Cadastro ‚Üí Autorizar ‚Üí Login permitido</li>
                </ul>
            </div>
            
            <p class="text-center" style="margin-top: 20px;">
                <a href="/" class="link">Voltar ao Portal</a>
            </p>
        </div>
    </div>

    <script>
        // Atualizar Role
        document.getElementById('updateRoleForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const novoRole = document.getElementById('novoRole').value;
            
            await processarRequest('/api/atualizar-role', { email, novoRole }, 'Role');
        });

        // Atualizar Autoriza√ß√£o
        document.getElementById('updateAuthForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('emailAuth').value;
            const autorizado = document.getElementById('autorizado').value;
            
            await processarRequest('/api/atualizar-autorizacao', { email, autorizado }, 'Autoriza√ß√£o');
        });

        // Fun√ß√£o comum para processar requests
        async function processarRequest(url, data, tipo) {
            const loading = document.getElementById('loading');
            const message = document.getElementById('message');
            
            loading.style.display = 'block';
            message.innerHTML = '';
            
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.sucesso) {
                    if (tipo === 'Role') {
                        message.innerHTML = `
                            <div class="success">
                                ‚úÖ Role atualizado com sucesso!<br>
                                <strong>Email:</strong> ${result.email}<br>
                                <strong>De:</strong> ${result.roleAnterior} ‚Üí <strong>Para:</strong> ${result.novoRole}
                            </div>
                        `;
                        document.getElementById('updateRoleForm').reset();
                    } else if (tipo === 'Autoriza√ß√£o') {
                        message.innerHTML = `
                            <div class="success">
                                ‚úÖ Autoriza√ß√£o atualizada com sucesso!<br>
                                <strong>Email:</strong> ${result.email}<br>
                                <strong>De:</strong> ${result.autorizacaoAnterior} ‚Üí <strong>Para:</strong> ${result.novaAutorizacao}
                            </div>
                        `;
                        document.getElementById('updateAuthForm').reset();
                    }
                } else {
                    message.innerHTML = '<div class="error">' + result.erro + '</div>';
                }
            } catch (error) {
                message.innerHTML = '<div class="error">Erro ao atualizar ' + tipo.toLowerCase() + '. Tente novamente.</div>';
            } finally {
                loading.style.display = 'none';
            }
        }
    </script>
</body>
</html>
