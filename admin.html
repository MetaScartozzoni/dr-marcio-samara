<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Administrativo - Dr. Marcio</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 25px;
        }
        
        .admin-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .admin-header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .admin-header p {
            font-size: 18px;
            opacity: 0.9;
        }

        /* Se√ß√£o de Cadastro */
        .cadastro-funcionario-section {
            background: white;
            margin-bottom: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .section-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-header h2 {
            margin: 0;
            font-size: 20px;
        }

        .btn-toggle {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-toggle:hover {
            background: rgba(255,255,255,0.3);
        }

        .cadastro-form {
            padding: 30px;
            background: #f8f9fa;
        }

        .form-grid-cadastro {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .foto-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .foto-preview {
            width: 150px;
            height: 150px;
            border: 3px dashed #667eea;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            background: white;
        }

        .foto-preview:hover {
            border-color: #5a6fd8;
            background: #f8f9ff;
        }

        .foto-preview input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .foto-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
        }

        .foto-preview i {
            font-size: 24px;
            color: #667eea;
            margin-bottom: 8px;
        }

        .foto-preview span {
            color: #667eea;
            font-size: 12px;
            text-align: center;
        }

        .btn-foto {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
        }

        .dados-pessoais,
        .dados-profissionais,
        .permissoes-cadastro {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
        }

        .dados-pessoais h3,
        .dados-profissionais h3,
        .permissoes-cadastro h3 {
            margin: 0 0 20px 0;
            color: #1e3c72;
            font-size: 16px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .form-col {
            flex: 1;
        }

        .form-col label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #1e3c72;
            font-size: 14px;
        }

        .form-col input,
        .form-col select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-col input:focus,
        .form-col select:focus {
            border-color: #667eea;
            outline: none;
        }

        .permissoes-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .permissao-tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }

        .btn-primary,
        .btn-secondary {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #28a745;
            color: white;
        }

        .btn-primary:hover {
            background: #218838;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        /* Quadro de Funcion√°rios */
        .funcionarios-section {
            background: white;
            margin-bottom: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .filtros-cracha {
            display: flex;
            gap: 15px;
        }

        .filtros-cracha select {
            padding: 8px 12px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 6px;
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .funcionarios-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            padding: 30px;
        }

        .cracha-funcionario {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .cracha-funcionario:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .cracha-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .cracha-foto {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 3px solid #667eea;
        }

        .cracha-foto img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .cracha-foto i {
            font-size: 24px;
            color: #667eea;
        }

        .cracha-info h4 {
            margin: 0 0 5px 0;
            color: #1e3c72;
            font-size: 16px;
        }

        .cracha-cargo {
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
        }

        .cracha-detalhes {
            font-size: 12px;
            color: #666;
            margin-bottom: 15px;
        }

        .cracha-detalhes div {
            margin-bottom: 3px;
        }

        .cracha-status {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .status-ativo { background: #28a745; }
        .status-inativo { background: #dc3545; }
        .status-pendente { background: #ffc107; }

        .cracha-permissoes {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 10px;
        }

        .permissao-mini {
            background: #e8f4fd;
            color: #1976d2;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 500;
        }

        /* Pacientes Pendentes */
        .pacientes-pendentes-section {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .pacientes-pendentes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding: 30px;
        }

        .paciente-card {
            background: #fff8e1;
            border: 2px solid #ff9800;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .paciente-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.3);
        }

        .paciente-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .paciente-info h4 {
            color: #e65100;
            margin: 0 0 8px 0;
            font-size: 16px;
        }

        .paciente-info p {
            color: #666;
            margin: 0 0 5px 0;
            font-size: 13px;
        }

        .btn-aprovar-paciente {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .form-grid-cadastro {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .funcionarios-grid {
                grid-template-columns: 1fr;
            }
            
            .pacientes-pendentes-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .filtros-cracha {
                flex-direction: column;
            }
        }

        /* Modal de detalhes expandido */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content-expandido {
            background: white;
            border-radius: 15px;
            width: 100%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .modal-header-expandido {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 25px 30px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .modal-body-expandido {
            padding: 30px;
        }

        .funcionario-detalhes {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .funcionario-foto-grande {
            text-align: center;
        }

        .funcionario-foto-grande img {
            width: 150px;
            height: 150px;
            border-radius: 15px;
            object-fit: cover;
            border: 4px solid #667eea;
        }

        .funcionario-dados {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .dados-grupo {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .dados-grupo h4 {
            margin: 0 0 15px 0;
            color: #1e3c72;
            font-size: 16px;
        }

        .dados-item {
            margin-bottom: 10px;
            font-size: 14px;
        }

        .dados-item strong {
            color: #1e3c72;
            display: inline-block;
            width: 120px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .message {
            margin: 20px 0;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <h1><i class="fas fa-users-cog"></i> Portal Administrativo</h1>
            <p>Gest√£o de Funcion√°rios e Sistema de Crach√°s</p>
        </div>

        <!-- √Årea de Cadastro de Funcion√°rio -->
        <div class="cadastro-funcionario-section">
            <div class="section-header">
                <h2><i class="fas fa-user-plus"></i> Cadastro de Funcion√°rio</h2>
                <button class="btn-toggle" onclick="toggleCadastroForm()">
                    <i class="fas fa-plus"></i> Novo Funcion√°rio
                </button>
            </div>
            
            <div id="cadastroForm" class="cadastro-form" style="display: none;">
                <form id="formCadastroFuncionario">
                    <div class="form-grid-cadastro">
                        <!-- √Årea da Foto -->
                        <div class="foto-section">
                            <div class="foto-preview" id="fotoPreview">
                                <i class="fas fa-camera"></i>
                                <span>Adicionar Foto</span>
                                <input type="file" id="fotoFuncionario" accept="image/*" onchange="previewFoto()">
                            </div>
                            <button type="button" class="btn-foto" onclick="document.getElementById('fotoFuncionario').click()">
                                <i class="fas fa-upload"></i> Selecionar Foto
                            </button>
                        </div>

                        <!-- Formul√°rio Detalhado -->
                        <div class="form-detalhado">
                            <!-- Dados Pessoais -->
                            <div class="dados-pessoais">
                                <h3><i class="fas fa-user"></i> Dados Pessoais</h3>
                                <div class="form-row">
                                    <div class="form-col">
                                        <label for="nomeCompleto">Nome Completo:</label>
                                        <input type="text" id="nomeCompleto" required placeholder="Nome completo do funcion√°rio">
                                    </div>
                                    <div class="form-col">
                                        <label for="emailFuncionario">Email Corporativo:</label>
                                        <input type="email" id="emailFuncionario" required placeholder="email@clinica.com">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-col">
                                        <label for="cpfFuncionario">CPF:</label>
                                        <input type="text" id="cpfFuncionario" required placeholder="000.000.000-00">
                                    </div>
                                    <div class="form-col">
                                        <label for="telefoneFuncionario">Telefone:</label>
                                        <input type="tel" id="telefoneFuncionario" required placeholder="(11) 99999-9999">
                                    </div>
                                </div>
                            </div>

                            <!-- Dados Profissionais -->
                            <div class="dados-profissionais">
                                <h3><i class="fas fa-briefcase"></i> Dados Profissionais</h3>
                                <div class="form-row">
                                    <div class="form-col">
                                        <label for="perfilFuncionario">Perfil/Cargo:</label>
                                        <select id="perfilFuncionario" required onchange="atualizarPermissoesCadastro()">
                                            <option value="">Selecione o cargo</option>
                                            <option value="administrativo">üè¢ Administrativo Geral</option>
                                            <option value="atendimento">üìû Atendimento/Recep√ß√£o</option>
                                            <option value="medico">üë®‚Äç‚öïÔ∏è M√©dico</option>
                                        </select>
                                    </div>
                                    <div class="form-col">
                                        <label for="setor">Setor:</label>
                                        <input type="text" id="setor" placeholder="Ex: Recep√ß√£o, Cirurgia, etc.">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-col">
                                        <label for="registro">Registro Profissional:</label>
                                        <input type="text" id="registro" placeholder="CRM, COREN, etc.">
                                    </div>
                                    <div class="form-col">
                                        <label for="especialidade">Especialidade:</label>
                                        <input type="text" id="especialidade" placeholder="√Årea de especializa√ß√£o">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-col">
                                        <label for="dataAdmissao">Data de Admiss√£o:</label>
                                        <input type="date" id="dataAdmissao" required>
                                    </div>
                                    <div class="form-col">
                                        <label for="salario">Sal√°rio:</label>
                                        <input type="number" id="salario" step="0.01" placeholder="0.00">
                                    </div>
                                </div>
                            </div>

                            <!-- Permiss√µes -->
                            <div class="permissoes-cadastro">
                                <h3><i class="fas fa-shield-alt"></i> Permiss√µes do Cargo</h3>
                                <div id="permissoesCadastro" class="permissoes-preview">
                                    <span style="color: #666;">Selecione um cargo para ver as permiss√µes</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="cancelarCadastro()">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-user-plus"></i> Cadastrar Funcion√°rio
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Quadro de Funcion√°rios (Crach√°s) -->
        <div class="funcionarios-section">
            <div class="section-header">
                <h2><i class="fas fa-id-card"></i> Quadro de Funcion√°rios</h2>
                <div class="filtros-cracha">
                    <select id="filtroCargo" onchange="filtrarFuncionarios()">
                        <option value="">Todos os Cargos</option>
                        <option value="administrativo">Administrativo</option>
                        <option value="atendimento">Atendimento</option>
                        <option value="medico">M√©dico</option>
                    </select>
                    <select id="filtroStatus" onchange="filtrarFuncionarios()">
                        <option value="">Todos os Status</option>
                        <option value="ativo">Ativo</option>
                        <option value="inativo">Inativo</option>
                        <option value="pendente">Pendente</option>
                    </select>
                </div>
            </div>

            <div id="funcionariosGrid" class="funcionarios-grid">
                <!-- Crach√°s ser√£o carregados dinamicamente -->
                <div class="loading">Carregando funcion√°rios...</div>
            </div>
        </div>

        <!-- Usu√°rios Externos Aguardando (Pacientes) -->
        <div class="pacientes-pendentes-section">
            <div class="section-header">
                <h2><i class="fas fa-users"></i> Cadastros Externos Aguardando</h2>
                <small style="opacity: 0.8;">Usu√°rios que se cadastraram pelo site (ser√£o classificados como pacientes)</small>
            </div>

            <div id="pacientesPendentes" class="pacientes-pendentes-grid">
                <!-- Cards de pacientes pendentes -->
                <div class="loading">Carregando cadastros pendentes...</div>
            </div>
        </div>

        <div id="loading" class="loading" style="display: none;">Carregando...</div>
        <div id="message" class="message"></div>
    </div>

    <!-- Modal de Detalhes do Funcion√°rio -->
    <div id="modalFuncionario" class="modal-overlay" style="display: none;">
        <div class="modal-content-expandido">
            <div class="modal-header-expandido">
                <h2><i class="fas fa-id-card"></i> Detalhes do Funcion√°rio</h2>
                <button class="modal-close" onclick="fecharModalFuncionario()">&times;</button>
            </div>
            
            <div class="modal-body-expandido">
                <div class="funcionario-detalhes">
                    <div class="funcionario-foto-grande">
                        <img id="modalFoto" src="" alt="Foto do funcion√°rio" style="display: none;">
                        <div id="modalFotoPlaceholder" style="width: 150px; height: 150px; background: #f0f0f0; border-radius: 15px; display: flex; align-items: center; justify-content: center; margin: 0 auto;">
                            <i class="fas fa-user" style="font-size: 48px; color: #667eea;"></i>
                        </div>
                        <button class="btn-foto" style="margin-top: 15px;" onclick="alterarFoto()">
                            <i class="fas fa-camera"></i> Alterar Foto
                        </button>
                    </div>

                    <div class="funcionario-dados">
                        <div class="dados-grupo">
                            <h4><i class="fas fa-user"></i> Dados Pessoais</h4>
                            <div class="dados-item">
                                <strong>Nome:</strong> <span id="modalNome">-</span>
                            </div>
                            <div class="dados-item">
                                <strong>Email:</strong> <span id="modalEmail">-</span>
                            </div>
                            <div class="dados-item">
                                <strong>CPF:</strong> <span id="modalCpf">-</span>
                            </div>
                            <div class="dados-item">
                                <strong>Telefone:</strong> <span id="modalTelefone">-</span>
                            </div>
                        </div>

                        <div class="dados-grupo">
                            <h4><i class="fas fa-briefcase"></i> Dados Profissionais</h4>
                            <div class="dados-item">
                                <strong>Cargo:</strong> <span id="modalCargo">-</span>
                            </div>
                            <div class="dados-item">
                                <strong>Setor:</strong> <span id="modalSetor">-</span>
                            </div>
                            <div class="dados-item">
                                <strong>Registro:</strong> <span id="modalRegistro">-</span>
                            </div>
                            <div class="dados-item">
                                <strong>Especialidade:</strong> <span id="modalEspecialidade">-</span>
                            </div>
                            <div class="dados-item">
                                <strong>Admiss√£o:</strong> <span id="modalAdmissao">-</span>
                            </div>
                        </div>

                        <div class="dados-grupo" style="grid-column: 1 / -1;">
                            <h4><i class="fas fa-shield-alt"></i> Permiss√µes Atuais</h4>
                            <div id="modalPermissoes" class="permissoes-preview">
                                <!-- Permiss√µes ser√£o carregadas -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button class="btn-secondary" onclick="editarFuncionario()">
                        <i class="fas fa-edit"></i> Editar
                    </button>
                    <button class="btn-primary" onclick="alterarPermissoes()">
                        <i class="fas fa-shield-alt"></i> Alterar Permiss√µes
                    </button>
                    <button class="btn-secondary" onclick="fecharModalFuncionario()">
                        <i class="fas fa-times"></i> Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let funcionarios = [];
        let pacientesPendentes = [];

        // Dados de exemplo
        const funcionariosExemplo = [
            {
                id: 1,
                nome: "Dr. Marcio Scartozzoni",
                email: "marcio@clinica.com",
                cargo: "medico",
                setor: "Cirurgia Pl√°stica",
                foto: null,
                status: "ativo",
                registro: "CRM 123456",
                especialidade: "Cirurgia Pl√°stica",
                telefone: "(11) 99999-9999",
                cpf: "123.456.789-00",
                admissao: "2020-01-15",
                permissoes: ["dashboard", "agendamento", "quadro-evolutivo", "caderno-digital", "prontuarios", "prescricoes", "laudos"]
            },
            {
                id: 2,
                nome: "Ana Paula Silva",
                email: "ana@clinica.com",
                cargo: "atendimento",
                setor: "Recep√ß√£o",
                foto: null,
                status: "ativo",
                registro: null,
                especialidade: null,
                telefone: "(11) 88888-8888",
                cpf: "987.654.321-00",
                admissao: "2022-03-10",
                permissoes: ["dashboard", "agendamento", "gestao-pacientes", "criar-agendamento"]
            },
            {
                id: 3,
                nome: "Carlos Santos",
                email: "carlos@clinica.com",
                cargo: "administrativo",
                setor: "Administra√ß√£o",
                foto: null,
                status: "ativo",
                registro: null,
                especialidade: null,
                telefone: "(11) 77777-7777",
                cpf: "456.789.123-00",
                admissao: "2021-06-20",
                permissoes: ["dashboard", "agendamento", "gestao-pacientes", "relatorios", "financeiro", "usuarios"]
            }
        ];

        const pacientesExemplo = [
            {
                id: 1,
                nome: "Maria Silva",
                email: "maria@email.com",
                telefone: "(11) 99999-1111",
                dataCadastro: "2025-07-29"
            },
            {
                id: 2,
                nome: "Jo√£o Santos",
                email: "joao@email.com",
                telefone: "(11) 99999-2222",
                dataCadastro: "2025-07-30"
            }
        ];

        // Inicializar p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar autentica√ß√£o
            const userInfo = localStorage.getItem('userInfo');
            if (!userInfo) {
                window.location.href = '/login.html';
                return;
            }

            const user = JSON.parse(userInfo);
            if (user.tipo !== 'admin') {
                alert('Acesso negado. Apenas administradores podem acessar esta p√°gina.');
                window.location.href = '/dashboard.html';
                return;
            }

            // Carregar dados
            carregarFuncionarios();
            carregarPacientesPendentes();

            // Definir data m√≠nima para admiss√£o
            document.getElementById('dataAdmissao').value = new Date().toISOString().split('T')[0];
        });

        // Toggle do formul√°rio de cadastro
        function toggleCadastroForm() {
            const form = document.getElementById('cadastroForm');
            const isVisible = form.style.display !== 'none';
            form.style.display = isVisible ? 'none' : 'block';
            
            const btn = document.querySelector('.btn-toggle');
            btn.innerHTML = isVisible ? 
                '<i class="fas fa-plus"></i> Novo Funcion√°rio' : 
                '<i class="fas fa-minus"></i> Fechar Formul√°rio';
        }

        // Preview da foto
        function previewFoto() {
            const input = document.getElementById('fotoFuncionario');
            const preview = document.getElementById('fotoPreview');
            
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Atualizar permiss√µes do cadastro
        function atualizarPermissoesCadastro() {
            const perfil = document.getElementById('perfilFuncionario').value;
            const container = document.getElementById('permissoesCadastro');
            
            const permissoesPorPerfil = {
                'administrativo': ['Dashboard', 'Agendamentos', 'Gest√£o Pacientes', 'Relat√≥rios', 'Financeiro', 'Usu√°rios'],
                'atendimento': ['Dashboard', 'Agendamentos', 'Gest√£o Pacientes', 'Criar Agendamentos'],
                'medico': ['Dashboard', 'Agendamentos', 'Quadro Evolutivo', 'Caderno Digital', 'Prontu√°rios', 'Prescri√ß√µes', 'Laudos']
            };
            
            if (perfil && permissoesPorPerfil[perfil]) {
                container.innerHTML = permissoesPorPerfil[perfil]
                    .map(perm => `<span class="permissao-tag">${perm}</span>`)
                    .join('');
            } else {
                container.innerHTML = '<span style="color: #666;">Selecione um cargo para ver as permiss√µes</span>';
            }
        }

        // Cancelar cadastro
        function cancelarCadastro() {
            document.getElementById('formCadastroFuncionario').reset();
            document.getElementById('fotoPreview').innerHTML = `
                <i class="fas fa-camera"></i>
                <span>Adicionar Foto</span>
                <input type="file" id="fotoFuncionario" accept="image/*" onchange="previewFoto()">
            `;
            toggleCadastroForm();
        }

        // Submeter cadastro de funcion√°rio
        document.getElementById('formCadastroFuncionario').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                nome: document.getElementById('nomeCompleto').value,
                email: document.getElementById('emailFuncionario').value,
                cpf: document.getElementById('cpfFuncionario').value,
                telefone: document.getElementById('telefoneFuncionario').value,
                cargo: document.getElementById('perfilFuncionario').value,
                setor: document.getElementById('setor').value,
                registro: document.getElementById('registro').value,
                especialidade: document.getElementById('especialidade').value,
                admissao: document.getElementById('dataAdmissao').value,
                salario: document.getElementById('salario').value
            };
            
            // Gerar senha provis√≥ria
            const senhaProvisoria = gerarSenhaProvisoria();
            
            // Simular cadastro
            alert(`‚úÖ Funcion√°rio cadastrado com sucesso!

üìß Email de acesso enviado para: ${formData.email}

üîê Dados de acesso:
   Email: ${formData.email}
   Senha: ${senhaProvisoria}

O funcion√°rio receber√° as credenciais por email e poder√° alterar a senha no primeiro acesso.`);
            
            // Adicionar √† lista (simula√ß√£o)
            const novoFuncionario = {
                id: Date.now(),
                ...formData,
                foto: null,
                status: 'ativo',
                permissoes: getPermissoesPorCargo(formData.cargo)
            };
            
            funcionarios.push(novoFuncionario);
            carregarFuncionarios();
            cancelarCadastro();
        });

        // Gerar senha provis√≥ria
        function gerarSenhaProvisoria() {
            return Math.random().toString(36).slice(-8);
        }

        // Obter permiss√µes por cargo
        function getPermissoesPorCargo(cargo) {
            const permissoes = {
                'administrativo': ['dashboard', 'agendamento', 'gestao-pacientes', 'relatorios', 'financeiro', 'usuarios'],
                'atendimento': ['dashboard', 'agendamento', 'gestao-pacientes', 'criar-agendamento'],
                'medico': ['dashboard', 'agendamento', 'quadro-evolutivo', 'caderno-digital', 'prontuarios', 'prescricoes', 'laudos']
            };
            return permissoes[cargo] || ['dashboard'];
        }

        // Carregar funcion√°rios
        function carregarFuncionarios() {
            const grid = document.getElementById('funcionariosGrid');
            
            if (funcionarios.length === 0) {
                funcionarios = [...funcionariosExemplo];
            }
            
            grid.innerHTML = funcionarios.map(func => `
                <div class="cracha-funcionario" onclick="abrirModalFuncionario(${func.id})">
                    <div class="cracha-status status-${func.status}"></div>
                    <div class="cracha-header">
                        <div class="cracha-foto">
                            ${func.foto ? 
                                `<img src="${func.foto}" alt="${func.nome}">` : 
                                '<i class="fas fa-user"></i>'
                            }
                        </div>
                        <div class="cracha-info">
                            <h4>${func.nome}</h4>
                            <div class="cracha-cargo">${getCargoTexto(func.cargo)}</div>
                        </div>
                    </div>
                    <div class="cracha-detalhes">
                        <div><i class="fas fa-envelope"></i> ${func.email}</div>
                        <div><i class="fas fa-building"></i> ${func.setor}</div>
                        ${func.registro ? `<div><i class="fas fa-id-badge"></i> ${func.registro}</div>` : ''}
                    </div>
                    <div class="cracha-permissoes">
                        ${func.permissoes.slice(0, 3).map(perm => 
                            `<span class="permissao-mini">${perm}</span>`
                        ).join('')}
                        ${func.permissoes.length > 3 ? 
                            `<span class="permissao-mini">+${func.permissoes.length - 3}</span>` : 
                            ''
                        }
                    </div>
                </div>
            `).join('');
        }

        // Carregar pacientes pendentes
        function carregarPacientesPendentes() {
            const grid = document.getElementById('pacientesPendentes');
            
            if (pacientesPendentes.length === 0) {
                pacientesPendentes = [...pacientesExemplo];
            }
            
            grid.innerHTML = pacientesPendentes.map(paciente => `
                <div class="paciente-card">
                    <div class="paciente-header">
                        <div class="paciente-info">
                            <h4>${paciente.nome}</h4>
                            <p><i class="fas fa-envelope"></i> ${paciente.email}</p>
                            <p><i class="fas fa-phone"></i> ${paciente.telefone}</p>
                            <p><i class="fas fa-calendar"></i> ${new Date(paciente.dataCadastro).toLocaleDateString('pt-BR')}</p>
                        </div>
                        <button class="btn-aprovar-paciente" onclick="aprovarPaciente(${paciente.id})">
                            <i class="fas fa-check"></i> Aprovar
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Aprovar paciente
        function aprovarPaciente(id) {
            const paciente = pacientesPendentes.find(p => p.id === id);
            if (!paciente) return;
            
            if (confirm(`Aprovar "${paciente.nome}" como paciente?`)) {
                // Remover da lista
                pacientesPendentes = pacientesPendentes.filter(p => p.id !== id);
                carregarPacientesPendentes();
                
                alert(`‚úÖ Paciente "${paciente.nome}" aprovado com sucesso!`);
            }
        }

        // Obter texto do cargo
        function getCargoTexto(cargo) {
            const cargos = {
                'administrativo': 'Administrativo',
                'atendimento': 'Atendimento',
                'medico': 'M√©dico'
            };
            return cargos[cargo] || cargo;
        }

        // Abrir modal do funcion√°rio
        function abrirModalFuncionario(id) {
            const funcionario = funcionarios.find(f => f.id === id);
            if (!funcionario) return;
            
            // Preencher dados no modal
            document.getElementById('modalNome').textContent = funcionario.nome;
            document.getElementById('modalEmail').textContent = funcionario.email;
            document.getElementById('modalCpf').textContent = funcionario.cpf;
            document.getElementById('modalTelefone').textContent = funcionario.telefone;
            document.getElementById('modalCargo').textContent = getCargoTexto(funcionario.cargo);
            document.getElementById('modalSetor').textContent = funcionario.setor || '-';
            document.getElementById('modalRegistro').textContent = funcionario.registro || '-';
            document.getElementById('modalEspecialidade').textContent = funcionario.especialidade || '-';
            document.getElementById('modalAdmissao').textContent = new Date(funcionario.admissao).toLocaleDateString('pt-BR');
            
            // Foto
            if (funcionario.foto) {
                document.getElementById('modalFoto').src = funcionario.foto;
                document.getElementById('modalFoto').style.display = 'block';
                document.getElementById('modalFotoPlaceholder').style.display = 'none';
            } else {
                document.getElementById('modalFoto').style.display = 'none';
                document.getElementById('modalFotoPlaceholder').style.display = 'flex';
            }
            
            // Permiss√µes
            const permissoesContainer = document.getElementById('modalPermissoes');
            permissoesContainer.innerHTML = funcionario.permissoes
                .map(perm => `<span class="permissao-tag">${perm}</span>`)
                .join('');
            
            // Mostrar modal
            document.getElementById('modalFuncionario').style.display = 'flex';
            window.currentFuncionario = funcionario;
        }

        // Fechar modal
        function fecharModalFuncionario() {
            document.getElementById('modalFuncionario').style.display = 'none';
            window.currentFuncionario = null;
        }

        // Fun√ß√µes do modal (placeholder)
        function alterarFoto() {
            alert('üöß Funcionalidade de alterar foto em desenvolvimento');
        }

        function editarFuncionario() {
            alert('üöß Funcionalidade de edi√ß√£o em desenvolvimento');
        }

        function alterarPermissoes() {
            alert('üöß Funcionalidade de alterar permiss√µes em desenvolvimento');
        }

        // Filtrar funcion√°rios
        function filtrarFuncionarios() {
            const filtroCargo = document.getElementById('filtroCargo').value;
            const filtroStatus = document.getElementById('filtroStatus').value;
            
            // TODO: Implementar filtros
            console.log('Filtros:', { cargo: filtroCargo, status: filtroStatus });
        }
    </script>
</body>
</html>
